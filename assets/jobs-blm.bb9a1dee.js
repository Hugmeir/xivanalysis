"use strict";(self.webpackChunk_xivanalysis_client=self.webpackChunk_xivanalysis_client||[]).push([[2680],{73905:function(t,e,a){a.d(e,{m:function(){return s},y:function(){return y}});var s,i=a(97530),n=a(68420),r=a(27344),o=a(90306),l=a(50596),c=a(2991),u=a.n(c),d=a(86359),h=a(71370),p=a(67294),m=a(65927),g=a(80967),f=a(40753),v=a(85893);!function(t){t[t.NEGATIVE=0]="NEGATIVE",t[t.NEUTRAL=1]="NEUTRAL",t[t.POSITIVE=2]="POSITIVE"}(s||(s={}));var y=function(t){(0,o.Z)(a,t);var e=(0,l.Z)(a);function a(){return(0,n.Z)(this,a),e.apply(this,arguments)}return(0,r.Z)(a,[{key:"render",value:function(){var t,e,s=this.props,n=s.targets,r=s.notes,o=s.data,l=s.onGoto,c=s.headerTitle;return(0,v.jsxs)(m.Z,{compact:!0,unstackable:!0,celled:!0,children:[(0,v.jsx)(m.Z.Header,{children:(0,v.jsxs)(m.Z.Row,{children:[(0,v.jsx)(m.Z.HeaderCell,{collapsing:!0,children:(0,v.jsx)("strong",{children:(0,v.jsx)(d.Trans,{id:"core.ui.rotation-table.header.time",defaults:"Time"})})}),u()(t=n||[]).call(t,(function(t,e){return(0,v.jsx)(m.Z.HeaderCell,{textAlign:"center",collapsing:!0,children:(0,v.jsx)("strong",{children:t.header})},"target_header_".concat(e))})),(0,v.jsx)(m.Z.HeaderCell,{children:(0,v.jsx)("strong",{children:c||(0,v.jsx)(d.Trans,{id:"core.ui.rotation-table.header.rotation",defaults:"Rotation"})})}),u()(e=r||[]).call(e,(function(t,e){return(0,v.jsx)(m.Z.HeaderCell,{textAlign:"center",collapsing:!0,children:(0,v.jsx)("strong",{children:t.header})},"note_header_".concat(e))}))]})}),(0,v.jsx)(m.Z.Body,{children:u()(o).call(o,(function(t){return(0,v.jsx)(a.Row,(0,i.Z)({onGoto:l,targets:n||[],notes:r||[]},t),t.start)}))})]})}}],[{key:"defaultTargetComparator",value:function(t,e){return(0,f.$K)(e)?t>=e?s.POSITIVE:s.NEGATIVE:s.NEUTRAL}}]),a}(p.Component);y.targetAccessorResolver=function(t,e){return"string"==typeof e.accessor&&null!=t.targetsData?t.targetsData[e.accessor]:"function"==typeof e.accessor?e.accessor(t):{actual:0,expected:0}},y.notesAccessorResolver=function(t,e){return"string"==typeof e.accessor&&null!=t.notesMap?t.notesMap[e.accessor]:"function"==typeof e.accessor?e.accessor(t):null},y.TargetCell=function(t){var e=t.actual,a=t.expected,i=t.targetComparator;void 0===i&&(i=y.defaultTargetComparator);var n=i(e,a);return(0,v.jsxs)(m.Z.Cell,{textAlign:"center",positive:n===s.POSITIVE,negative:n===s.NEGATIVE,children:[e,"/",void 0===a?"-":a]})},y.Row=function(t){var e,a,s=t.onGoto,n=t.targets,r=t.notes,o=t.notesMap,l=t.start,c=t.end,d=t.targetsData,p=t.rotation;return(0,v.jsxs)(m.Z.Row,{children:[(0,v.jsxs)(m.Z.Cell,{textAlign:"center",children:[(0,v.jsx)("span",{style:{marginRight:5},children:(0,f.LU)(l,{secondPrecision:0})}),"function"==typeof s&&(0,v.jsx)(g.Z,{circular:!0,compact:!0,size:"mini",icon:"time",onClick:function(){return s(l,c)}})]}),u()(e=u()(n).call(n,(function(t){return y.targetAccessorResolver({start:l,end:c,targetsData:d,rotation:p},t)}))).call(e,(function(t,e){return(0,v.jsx)(y.TargetCell,(0,i.Z)({},t),"target_".concat(e))})),(0,v.jsx)(m.Z.Cell,{children:(0,v.jsx)(h.Z,{events:p})}),u()(a=u()(r).call(r,(function(t){return y.notesAccessorResolver({start:l,end:c,targetsData:d,notesMap:o,rotation:p},t)}))).call(a,(function(t,e){return(0,v.jsx)(m.Z.Cell,{textAlign:"center",children:t},"notes_".concat(e))}))]})}},83459:function(t,e,a){a.d(e,{E:function(){return C}});var s,i,n,r,o,l,c,u,d,h=a(23257),p=a(68420),m=a(27344),g=a(5281),f=a(90306),v=a(50596),y=a(300),I=a(77766),b=a.n(I),T=a(86359),x=a(59652),E=a(84626),w=(a(67294),a(28683)),Z=a(76704),R=a(73947),A=a(48453),S=a(51422),j=a(85893),k={__all:{id:"core.gcd.no-statistics.v2",defaults:"This GCD recast is an *estimate*, and may be incorrect. If it is reporting a GCD recast *longer* than reality, you likely need to focus on keeping your GCD rolling."},legacyFflogs:{id:"core.gcd.estimate-help.fflogs",defaults:"Precise attribute values are only available from FF Logs for the player who logged the report in ACT."}},C=(s=Reflect.metadata("design:type",R.V),i=Reflect.metadata("design:type",S.gy),n=Reflect.metadata("design:type",A.a),d=u=function(t){(0,f.Z)(a,t);var e=(0,v.Z)(a);function a(){var t,s;(0,p.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return s=e.call.apply(e,b()(t=[this]).call(t,n)),(0,h.Z)(s,"data",o,(0,g.Z)(s)),(0,h.Z)(s,"statistics",l,(0,g.Z)(s)),(0,h.Z)(s,"speedAdjustments",c,(0,g.Z)(s)),s}return(0,m.Z)(a,[{key:"initialise",value:function(){this.addEventHook("complete",this.onComplete)}},{key:"getDuration",value:function(){return this.speedAdjustments.getAdjustedDuration({duration:E.b})}},{key:"isEstimated",value:function(){return this.speedAdjustments.isAdjustmentEstimated()}},{key:"onComplete",value:function(){var t=this.isEstimated();this.statistics.add(new S.IC({title:t?(0,j.jsx)(T.Trans,{id:"core.gcd.estimated-gcd",defaults:"Estimated GCD"}):(0,j.jsx)(T.Trans,{id:"core.gcd.gcd",defaults:"GCD Recast"}),icon:this.data.actions.ATTACK.icon,value:this.parser.formatDuration(this.getDuration()),info:t?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(x.Z,{source:k.__all}),(0,j.jsx)(x.Z,{source:k[this.parser.report.meta.source]})]}):void 0}))}}]),a}(w.qk),u.handle="gcd",r=d,o=(0,y.Z)(r.prototype,"data",[Z.I,s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.data}}),l=(0,y.Z)(r.prototype,"statistics",[Z.I,i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.statistics}}),c=(0,y.Z)(r.prototype,"speedAdjustments",[Z.I,n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.speedAdjustments}}),r)},48989:function(t,e,a){a.d(e,{e:function(){return M}});var s,i,n,r,o,l,c,u,d,h,p,m=a(97530),g=a(23257),f=a(68420),v=a(27344),y=a(5281),I=a(90306),b=a(50596),T=a(300),x=a(77766),E=a.n(x),w=a(2991),Z=a.n(w),R=a(86359),A=a(9263),S=a(95859),j=a(28683),k=a(52250),C=a(56611),P=(a(67294),a(65927)),D=a(80967),F=a(74489),_=a(76704),G=a(8510),O=a(73947),H=a(85893),M=(s=Reflect.metadata("design:type",G.Z),i=Reflect.metadata("design:type",O.V),n=Reflect.metadata("design:type",k.ZP),r=Reflect.metadata("design:type",C.TY),p=h=function(t){(0,I.Z)(a,t);var e=(0,b.Z)(a);function a(){var t,s;(0,f.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return s=e.call.apply(e,E()(t=[this]).call(t,n)),(0,g.Z)(s,"castTime",l,(0,y.Z)(s)),(0,g.Z)(s,"data",c,(0,y.Z)(s)),(0,g.Z)(s,"suggestions",u,(0,y.Z)(s)),(0,g.Z)(s,"timeline",d,(0,y.Z)(s)),s.currentCast=void 0,s.droppedCasts=[],s.missedTimeMS=0,s.icon=S.ZP.INTERJECT.icon,s.severity={2:k.bI.MEDIUM,5:k.bI.MAJOR},s.suggestionContent=(0,H.jsx)(R.Trans,{id:"core.interrupts.suggestion.content",defaults:"Avoid interrupting casts by either prepositioning yourself or utilizing slidecasting where possible. If you have to move, try to save an instant cast to keep your GCD rolling."}),s}return(0,v.Z)(a,[{key:"suggestionWhy",value:function(t,e){return(0,H.jsx)(R.Trans,{id:"core.interrupts.suggestion.why",defaults:"You missed {0} casts (approximately {1} of total casting time) due to interruption.",values:{0:t.length,1:this.parser.formatDuration(e)}})}},{key:"noInterruptsOutput",value:function(){}},{key:"initialise",value:function(){this.addEventHook((0,F.hX)().type("prepare").source(this.parser.actor.id),this.onBeginCast),this.addEventHook((0,F.hX)().type("interrupt").source(this.parser.actor.id),this.pushDropCasts),this.addEventHook("complete",this.onComplete)}},{key:"onBeginCast",value:function(t){this.currentCast=t}},{key:"pushDropCasts",value:function(t){var e,a,s;if(null!=this.currentCast){var i=null!==(e=this.castTime.forAction(this.currentCast.action,this.currentCast.timestamp))&&void 0!==e?e:0;this.missedTimeMS+=Math.min(t.timestamp-(null!==(a=null===(s=this.currentCast)||void 0===s?void 0:s.timestamp)&&void 0!==a?a:this.parser.currentEpochTimestamp),i),this.droppedCasts.push(t),this.currentCast=void 0}}},{key:"onComplete",value:function(){this.suggestions.add(new k.eg({icon:this.icon,tiers:this.severity,value:this.droppedCasts.length,content:this.suggestionContent,why:this.suggestionWhy(this.droppedCasts,this.missedTimeMS)}))}},{key:"output",value:function(){var t,e=this;return 0===this.droppedCasts.length?this.noInterruptsOutput():(0,H.jsxs)(P.Z,{compact:!0,unstackable:!0,celled:!0,collapsing:!0,children:[(0,H.jsx)(P.Z.Header,{children:(0,H.jsxs)(P.Z.Row,{children:[(0,H.jsx)(P.Z.HeaderCell,{collapsing:!0,children:(0,H.jsx)("strong",{children:(0,H.jsx)(R.Trans,{id:"core.interrupts.table.time",defaults:"Time"})})}),(0,H.jsx)(P.Z.HeaderCell,{children:(0,H.jsx)("strong",{children:(0,H.jsx)(R.Trans,{id:"core.interrupts.table.cast",defaults:"Cast"})})})]})}),(0,H.jsx)(P.Z.Body,{children:Z()(t=this.droppedCasts).call(t,(function(t){var a=e.data.getAction(t.action);return(0,H.jsxs)(P.Z.Row,{children:[(0,H.jsxs)(P.Z.Cell,{textAlign:"center",children:[(0,H.jsx)("span",{style:{marginRight:5},children:e.parser.formatEpochTimestamp(t.timestamp)}),(0,H.jsx)(D.Z,{circular:!0,compact:!0,size:"mini",icon:"time",onClick:function(){return e.timeline.show(t.timestamp-e.parser.pull.timestamp,t.timestamp-e.parser.pull.timestamp+3e4)}})]}),(0,H.jsx)(P.Z.Cell,{children:(0,H.jsx)(A.vm,(0,m.Z)({},a))})]},t.timestamp)}))})]})}}]),a}(j.qk),h.handle="interrupts",h.title={id:"core.interrupts.title",defaults:"Interrupted Casts"},h.debug=!1,o=p,l=(0,T.Z)(o.prototype,"castTime",[_.I,s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.castTime}}),c=(0,T.Z)(o.prototype,"data",[_.I,i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.data}}),u=(0,T.Z)(o.prototype,"suggestions",[_.I,n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.suggestions}}),d=(0,T.Z)(o.prototype,"timeline",[_.I,r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.timeline}}),o)},32596:function(t,e,a){a.d(e,{t:function(){return C}});var s,i,n,r,o,l,c,u=a(97530),d=a(41420),h=a(99021),p=a(23257),m=a(68420),g=a(27344),f=a(5281),v=a(90306),y=a(50596),I=a(300),b=a(77766),T=a.n(b),x=a(80426),E=a.n(x),w=a(47302),Z=a.n(w),R=a(40753),A=a(28683),S=a(76704),j=a(73947),k=a(90577),C=(s=Reflect.metadata("design:type",j.V),i=Reflect.metadata("design:type",k.I),c=l=function(t){(0,v.Z)(a,t);var e=(0,y.Z)(a);function a(){var t,s;(0,m.Z)(this,a);for(var i=arguments.length,n=new Array(i),l=0;l<i;l++)n[l]=arguments[l];return s=e.call.apply(e,T()(t=[this]).call(t,n)),(0,p.Z)(s,"data",r,(0,f.Z)(s)),(0,p.Z)(s,"invulnerability",o,(0,f.Z)(s)),s.ft=function(t){return s.parser.formatEpochTimestamp(t,1)},s}return(0,g.Z)(a,[{key:"getUptime",value:function(t,e){var a=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.parser.actor,i="string"==typeof t?this.data.statuses[t]:t,n=(0,R.rY)(e),r=E()(n).call(n,(function(t){var e,n;return a.edgesForActor(t,null!==(e=null===(n=t.statusHistory.get(i.id))||void 0===n?void 0:n.get(s.id))&&void 0!==e?e:[])}));Z()(r).call(r,(function(t,e){return t.timestamp-e.timestamp}));var o,l={uptime:0,depth:0,application:0},c=(0,h.Z)(r);try{for(c.s();!(o=c.n()).done;){var u,d,p,m=o.value;"apply"===m.side?(0===l.depth&&(l.application=m.timestamp),l.depth++):(l.depth--,0===l.depth&&(l.uptime+=m.timestamp-l.application)),this.debug(T()(u=T()(d=T()(p="Status ".concat(i.name," ")).call(p,m.side," at ")).call(d,this.ft(m.timestamp),", depth=")).call(u,l.depth))}}catch(t){c.e(t)}finally{c.f()}return l.uptime}},{key:"edgesForActor",value:function(t,e){var a,s,i,n=[],r=(0,h.Z)(e);try{for(r.s();!(i=r.n()).done;){var o,l=i.value;"statusApply"!==l.type?null!=a&&(n.push.apply(n,(0,d.Z)(this.splitRangeForInvulns(t,a.timestamp,l.timestamp))),a=void 0):(null!==(o=a)&&void 0!==o||(a=l),s=l)}}catch(t){r.e(t)}finally{r.f()}if(null!=a){var c,u,p=null===(c=this.data.getStatus(a.status))||void 0===c?void 0:c.duration,m=null==p?this.parser.currentEpochTimestamp:Math.min((null!==(u=s)&&void 0!==u?u:a).timestamp+p,this.parser.currentEpochTimestamp);n.push.apply(n,(0,d.Z)(this.splitRangeForInvulns(t,a.timestamp,m)))}return n}},{key:"splitRangeForInvulns",value:function(t,e,a){var s,i={apply:e,remove:a},n=[i],r=this.invulnerability.getWindows({start:e,end:a,actorFilter:function(e){return e.kind===t.kind},types:["invulnerable"]}),o=(0,h.Z)(r);try{for(o.s();!(s=o.n()).done;){var l,c,d,p,m,g,f,v,y,I,b,x=s.value;if(x.start<i.apply&&x.end>=i.apply)this.debug(T()(g=T()(f=T()(v="Start clip, [".concat(this.ft(i.apply),",")).call(v,this.ft(i.remove),"] -> [")).call(f,this.ft(x.end),",")).call(g,this.ft(i.remove),"]")),i.apply=x.end;else if(x.start<=i.remove&&x.end>i.remove)this.debug(T()(y=T()(I=T()(b="End clip, [".concat(this.ft(i.apply),",")).call(b,this.ft(i.remove),"] -> [")).call(I,this.ft(i.apply),",")).call(y,this.ft(x.start),"]")),i.remove=x.start;else if(!(x.start<i.apply||x.end>i.remove)){this.debug(T()(l=T()(c=T()(d=T()(p=T()(m="Split [".concat(this.ft(i.apply),",")).call(m,this.ft(i.remove),"] -> [")).call(p,this.ft(i.apply),",")).call(d,this.ft(x.start),"], [")).call(c,this.ft(x.end),",")).call(l,this.ft(i.remove),"]"));var w=i;i=(0,u.Z)({},i),n.push(i),w.remove=x.start,i.apply=x.end}}}catch(t){o.e(t)}finally{o.f()}return E()(n).call(n,(function(t){return[{side:"apply",timestamp:t.apply},{side:"remove",timestamp:t.remove}]}))}}]),a}(A.qk),l.handle="statuses",l.debug=!1,n=c,r=(0,I.Z)(n.prototype,"data",[S.I,s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.data}}),o=(0,I.Z)(n.prototype,"invulnerability",[S.I,i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.invulnerability}}),n)},45715:function(t,e,a){a.d(e,{x:function(){return V}});var s,i,n,r,o,l,c,u,d,h,p,m=a(41420),g=a(97530),f=a(23257),v=a(68420),y=a(27344),I=a(5281),b=a(90306),T=a(50596),x=a(300),E=a(77766),w=a.n(E),Z=a(20116),R=a.n(Z),A=a(2991),S=a.n(A),j=a(86359),k=a(40090),C=a(71370),P=a(84626),D=a(28683),F=a(74489),_=a(76704),G=a(8510),O=a(73947),H=a(90577),M=a(52250),U=(a(67294),a(30919)),L=a(40753),N=a(85893),W={0:2,1e3:1,2500:0},B={1:M.bI.MEDIUM,5:M.bI.MAJOR},V=(s=Reflect.metadata("design:type",G.Z),i=Reflect.metadata("design:type",O.V),n=Reflect.metadata("design:type",H.I),r=Reflect.metadata("design:type",M.ZP),p=h=function(t){(0,b.Z)(a,t);var e=(0,T.Z)(a);function a(){var t,s;(0,v.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return s=e.call.apply(e,w()(t=[this]).call(t,n)),(0,f.Z)(s,"castTime",l,(0,I.Z)(s)),(0,f.Z)(s,"data",c,(0,I.Z)(s)),(0,f.Z)(s,"invulnerability",u,(0,I.Z)(s)),(0,f.Z)(s,"suggestions",d,(0,I.Z)(s)),s.suggestionIcon="https://xivapi.com/i/001000/001785.png",s.moduleLink=(0,N.jsx)("a",{style:{cursor:"pointer"},onClick:function(){return s.parser.scrollTo(a.handle)},children:(0,N.jsx)(k.Z,{message:a.title})}),s.suggestionContent=(0,N.jsx)(j.Trans,{id:"core.weaving.content",defaults:"Avoid weaving more actions than you have time for in a single GCD window. Doing so will delay your next GCD, reducing possible uptime. Check the {0} module below for more detailed analysis.",values:{0:s.moduleLink}}),s.severity=B,s.weaves=[],s.ongoingCastEvent=void 0,s.leadingGcdEvent=void 0,s.trailingGcdEvent=void 0,s.badWeaves=[],s}return(0,y.Z)(a,[{key:"initialise",value:function(){var t=(0,F.hX)().source(this.parser.actor.id);this.addEventHook(t.type("prepare"),this.onBeginCast),this.addEventHook(t.type("action"),this.onCast),this.addEventHook((0,F.hX)().type("complete"),this.onComplete),this.addEventHook((0,F.hX)().type("death"),this.clearWeave)}},{key:"onBeginCast",value:function(t){this.ongoingCastEvent=t}},{key:"onCast",value:function(t){var e=this.data.getAction(t.action);e&&!e.autoAttack&&(this.isOgcd(e)?this.weaves.push(t):(this.ongoingCastEvent&&this.ongoingCastEvent.action===e.id?this.trailingGcdEvent=(0,g.Z)((0,g.Z)({},t),{},{timestamp:this.ongoingCastEvent.timestamp}):this.trailingGcdEvent=t,this.ongoingCastEvent=void 0,this.saveIfBad(),this.leadingGcdEvent=this.trailingGcdEvent,this.weaves=[]))}},{key:"onComplete",value:function(){this.leadingGcdEvent&&this.saveIfBad(),this.suggestions.add(new M.eg({icon:this.suggestionIcon,content:this.suggestionContent,why:(0,N.jsx)(j.Trans,{id:"core.weaving.why",defaults:"{0, plural, =1 {# instance of incorrect weaving} other {# instances of incorrect weaving}}",values:{0:this.badWeaves.length}}),tiers:this.severity,value:this.badWeaves.length}))}},{key:"saveIfBad",value:function(){var t,e;if(null!=this.trailingGcdEvent){var a=null!==(t=null===(e=this.leadingGcdEvent)||void 0===e?void 0:e.timestamp)&&void 0!==t?t:this.parser.pull.timestamp,s=this.trailingGcdEvent.timestamp-a-this.invulnerability.getDuration({start:a,end:this.trailingGcdEvent.timestamp}),i={leadingGcdEvent:this.leadingGcdEvent,trailingGcdEvent:this.trailingGcdEvent,gcdTimeDiff:s,weaves:this.weaves};0!==i.weaves.length&&this.isBadWeave(i)&&this.badWeaves.push(i)}}},{key:"isOgcd",value:function(t){return!t.onGcd&&!t.autoAttack}},{key:"isBadWeave",value:function(t){var e,a,s=this,i=R()(e=t.weaves).call(e,(function(t){return!s.invulnerability.isActive({timestamp:t.timestamp,types:["untargetable"]})&&t.timestamp>=s.parser.pull.timestamp})).length,n=null!==(a=null!=t.leadingGcdEvent?this.castTime.recastForEvent(t.leadingGcdEvent):void 0)&&void 0!==a?a:P.b;return t.gcdTimeDiff>n&&i>this.getMaxWeaves(t)}},{key:"clearWeave",value:function(){this.weaves.length>0&&this.saveIfBad(),this.weaves=[],this.leadingGcdEvent=void 0}},{key:"getMaxWeaves",value:function(t){var e,a;if(null==t.leadingGcdEvent)return 2;var s=this.castTime.forEvent(t.leadingGcdEvent);return null==s?2:(null!==(e=(0,L.CL)(W,s))&&void 0!==e?e:2)-((null!==(a=this.castTime.recastForEvent(t.leadingGcdEvent))&&void 0!==a?a:P.b)<1800?1:0)}},{key:"output",value:function(){var t,e=this;if(0===this.badWeaves.length)return!1;var a=S()(t=this.badWeaves).call(t,(function(t){var a,s,i,n,r;return{key:null!==(a=null===(s=t.leadingGcdEvent)||void 0===s?void 0:s.timestamp)&&void 0!==a?a:e.parser.pull.timestamp,title:{content:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("strong",{children:e.parser.formatEpochTimestamp(null!==(i=null===(n=t.leadingGcdEvent)||void 0===n?void 0:n.timestamp)&&void 0!==i?i:e.parser.pull.timestamp)})," - ",(0,N.jsx)(j.Trans,{id:"core.weaving.panel-count",defaults:"{0, plural, =1 {# weave} other {# weaves}}",values:{0:t.weaves.length}})," (",e.parser.formatDuration(t.gcdTimeDiff)," ",(0,N.jsx)(j.Trans,{id:"core.weaving.between-gcds",defaults:"between GCDs"}),")"]})},content:{content:(0,N.jsx)(C.Z,{events:w()(r=[]).call(r,(0,m.Z)(null!=t.leadingGcdEvent?[t.leadingGcdEvent]:[]),(0,m.Z)(t.weaves))})}}}));return(0,N.jsx)(U.Z,{exclusive:!1,panels:a,styled:!0,fluid:!0})}}]),a}(D.qk),h.handle="weaving",h.title={id:"core.weaving.title",defaults:"Weaving Issues"},o=p,l=(0,x.Z)(o.prototype,"castTime",[_.I,s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.castTime}}),c=(0,x.Z)(o.prototype,"data",[_.I,i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.data}}),u=(0,x.Z)(o.prototype,"invulnerability",[_.I,n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.invulnerability}}),d=(0,x.Z)(o.prototype,"suggestions",[_.I,r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.suggestions}}),o)},1321:function(t,e,a){a.r(e),a.d(e,{default:function(){return Ga}});var s,i,n,r,o,l,c,u,d,h,p,m,g,f,v,y,I,b,T,x,E,w,Z,R,A,S,j,k,C,P,D,F,_,G,O,H,M,U,L,N,W,B,V,z,Y,X,q,J,$,K,Q,tt,et,at,st,it,nt,rt,ot,lt,ct,ut,dt,ht,pt,mt,gt,ft,vt,yt,It,bt,Tt,xt,Et,wt,Zt,Rt,At,St,jt,kt,Ct,Pt,Dt,Ft,_t,Gt,Ot,Ht,Mt,Ut,Lt,Nt,Wt,Bt,Vt=a(48989),zt=a(68420),Yt=a(90306),Xt=a(50596),qt=a(77766),Jt=a.n(qt),$t=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(s=e.call.apply(e,Jt()(t=[this]).call(t,n))).suggestionIcon=s.data.actions.FOUL.icon,s.trackedActions=[{aoeAction:s.data.actions.FOUL,stActions:[s.data.actions.XENOGLOSSY],minTargets:2},{aoeAction:s.data.actions.FLARE,stActions:[s.data.actions.DESPAIR],minTargets:3},{aoeAction:s.data.actions.THUNDER_IV,stActions:[s.data.actions.THUNDER_III],minTargets:2},{aoeAction:s.data.actions.BLIZZARD_II,stActions:[s.data.actions.BLIZZARD_III],minTargets:3},{aoeAction:s.data.actions.HIGH_BLIZZARD_II,stActions:[s.data.actions.BLIZZARD_III],minTargets:3},{aoeAction:s.data.actions.FIRE_II,stActions:[s.data.actions.FIRE_III,s.data.actions.FIRE_IV],minTargets:3},{aoeAction:s.data.actions.HIGH_FIRE_II,stActions:[s.data.actions.FIRE_III,s.data.actions.FIRE_IV],minTargets:3},{aoeAction:s.data.actions.FREEZE,stActions:[s.data.actions.BLIZZARD_IV],minTargets:3}],s}return a}(a(54106).C),Kt=a(27344),Qt=a(18527),te=a(3362),ee=a(74489),ae=a(8510),se=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(s=e.call.apply(e,Jt()(t=[this]).call(t,n))).tcIndex=null,s}return(0,Kt.Z)(a,[{key:"initialise",value:function(){(0,Qt.Z)((0,te.Z)(a.prototype),"initialise",this).call(this);var t=(0,ee.hX)().target(this.parser.actor.id).status(this.data.statuses.TRIPLECAST.id);this.addEventHook(t.type("statusApply"),this.onApplyTriplecast),this.addEventHook(t.type("statusRemove"),this.onRemoveTriplecast)}},{key:"onApplyTriplecast",value:function(){this.onRemoveTriplecast(),this.tcIndex=this.setInstantCastAdjustment()}},{key:"onRemoveTriplecast",value:function(){this.reset(this.tcIndex),this.tcIndex=null}}]),a}(ae.Z),ie=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(s=e.call.apply(e,Jt()(t=[this]).call(t,n))).trackedDefensives=[s.data.actions.MANAWARD],s}return a}(a(12541).O),ne=a(23257),re=a(5281),oe=a(300),le=a(41420),ce=a(2991),ue=a.n(ce),de=a(78580),he=a.n(de),pe=a(20116),me=a.n(pe),ge=a(86359),fe=a(6767),ve=a.n(fe),ye=a(9263),Ie=a(43719),be=a(76704),Te=a(78766),xe=a(52250),Ee=a(3085),we=a(67294),Ze=a(40753),Re=["FIRE_I","FIRE_II","FIRE_III","FIRE_IV","FLARE","DESPAIR","HIGH_FIRE_II"],Ae=["UMBRAL_SOUL"],Se=["BLIZZARD_I","BLIZZARD_II","BLIZZARD_III","BLIZZARD_IV","FREEZE","HIGH_BLIZZARD_II"],je=Jt()(s=[]).call(s,Ae,Se),ke=a(85893),Ce=3e4,Pe=15e3,De="astralumbral",Fe=Jt()(i=[]).call(i,(0,le.Z)(Re),(0,le.Z)(Se),["PARADOX"]),_e=Jt()(n=[]).call(n,(0,le.Z)(Ae),["TRANSPOSE","FOUL","XENOGLOSSY","AMPLIFIER","PARADOX"]),Ge=.5,Oe=.25,He=.75,Me=ve()("#2F70B1"),Ue=ve()("#D23D26"),Le=ve()(Ie.W.BLACK_MAGE.colour),Ne=(r=Reflect.metadata("design:type",xe.ZP),o=Reflect.metadata("design:type",Ee.b),l=Reflect.metadata("design:type",ae.Z),m=p=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s,i;(0,zt.Z)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return i=e.call.apply(e,Jt()(t=[this]).call(t,r)),(0,ne.Z)(i,"suggestions",u,(0,re.Z)(i)),(0,ne.Z)(i,"unableToAct",d,(0,re.Z)(i)),(0,ne.Z)(i,"castTime",h,(0,re.Z)(i)),i.droppedEnoTimestamps=[],i.overwrittenPolyglot=0,i.fireSpellIds=ue()(Re).call(Re,(function(t){return i.data.actions[t].id})),i.iceSpellIds=Jt()(s=[]).call(s,(0,le.Z)(ue()(Se).call(Se,(function(t){return i.data.actions[t].id}))),(0,le.Z)(ue()(Ae).call(Ae,(function(t){return i.data.actions[t].id})))),i.affectsGaugeOnDamage=ue()(Fe).call(Fe,(function(t){return i.data.actions[t].id})),i.castTimeIndex=null,i.paradoxInstantIndex=null,i.astralFireGauge=i.add(new Te.qT({maximum:3,graph:{handle:De,label:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.resource.astral-fire",defaults:"Astral Fire"}),color:Ue.fade(Ge)}})),i.astralFireTimer=i.add(new Te.vf({maximum:Pe,onExpiration:i.onAstralUmbralTimeout.bind((0,re.Z)(i)),graph:{handle:De,label:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.resource.astral-timer",defaults:"Astral Fire Timer"}),color:Ue.fade(He)}})),i.umbralIceGauge=i.add(new Te.qT({maximum:3,graph:{handle:De,label:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.resource.umbral-ice",defaults:"Umbral Ice"}),color:Me.fade(Ge)}})),i.umbralIceTimer=i.add(new Te.vf({maximum:Pe,onExpiration:i.onAstralUmbralTimeout.bind((0,re.Z)(i)),graph:{handle:De,label:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.resource.umbral-timer",defaults:"Umbral Ice Timer"}),color:Me.fade(He)}})),i.paradoxGauge=i.add(new Te.qT({maximum:1,graph:{label:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.resource.paradox",defaults:"Paradox"}),color:Ue.fade(Oe)},correctHistory:!0})),i.umbralHeartsGauge=i.add(new Te.qT({maximum:3,graph:{label:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.resource.umbral-hearts",defaults:"Umbral Hearts"}),color:Me.fade(Oe)}})),i.polyglotGauge=i.add(new Te.qT({maximum:2,graph:{label:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.resource.polyglot",defaults:"Polyglot"}),color:Le.fade(Oe)},correctHistory:!0})),i.polyglotTimer=i.add(new Te.vf({maximum:Ce,onExpiration:i.onPolyglotTimerComplete.bind((0,re.Z)(i)),graph:{label:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.resource.polyglot-timer",defaults:"Polyglot Timer"}),color:Le.fade(He)}})),i.previousGaugeState=i.getGaugeState(i.parser.pull.timestamp),i}return(0,Kt.Z)(a,[{key:"initialise",value:function(){(0,Qt.Z)((0,te.Z)(a.prototype),"initialise",this).call(this);var t=(0,ee.hX)().source(this.parser.actor.id);this.addEventHook(t.type("action").action(this.data.matchActionId(_e)),this.onCast),this.addEventHook(t.type("damage").cause(this.data.matchCauseActionId(this.affectsGaugeOnDamage)),this.onCast),this.addEventHook("complete",this.onComplete),this.resourceGraphs.addDataGroup({handle:De,label:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.resource.astral-umbral",defaults:"Astral Fire and<0></0>Umbral Ice",components:[(0,ke.jsx)("br",{})]}),collapse:!0,forceCollapsed:!0})}},{key:"getGaugeState",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parser.currentEpochTimestamp,e=this.astralFireGauge.getValueAt(t),a=this.umbralIceGauge.getValueAt(t);return{astralFire:e,umbralIce:a,umbralHearts:this.umbralHeartsGauge.getValueAt(t),polyglot:this.polyglotGauge.getValueAt(t),enochian:e>0||a>0,paradox:this.paradoxGauge.getValueAt(t)}}},{key:"onCast",value:function(t){var e,a;if("cause"in t&&"action"in t.cause?a=t.cause.action:"action"in t&&(a=t.action),null!=a&&(!he()(e=this.affectsGaugeOnDamage).call(e,a)||"damage"!==t.type||(0,Ze.SV)(t)))switch(a){case this.data.actions.BLIZZARD_I.id:this.onGainUmbralIceStacks(1);break;case this.data.actions.BLIZZARD_II.id:case this.data.actions.HIGH_BLIZZARD_II.id:case this.data.actions.BLIZZARD_III.id:this.onGainUmbralIceStacks(3,!1);break;case this.data.actions.FREEZE.id:case this.data.actions.BLIZZARD_IV.id:this.umbralIceGauge.empty&&this.onGainUmbralIceStacks(1,!1),this.umbralHeartsGauge.set(3),this.addEvent();break;case this.data.actions.UMBRAL_SOUL.id:this.onGainUmbralIceStacks(1),this.tryGainUmbralHearts(1);break;case this.data.actions.FIRE_I.id:this.tryConsumeUmbralHearts(1),this.onGainAstralFireStacks(1);break;case this.data.actions.FIRE_II.id:case this.data.actions.HIGH_FIRE_II.id:case this.data.actions.FIRE_III.id:this.tryConsumeUmbralHearts(1),this.onGainAstralFireStacks(3,!1);break;case this.data.actions.FIRE_IV.id:this.astralFireGauge.empty&&this.onGainAstralFireStacks(1,!1),this.tryConsumeUmbralHearts(1);break;case this.data.actions.DESPAIR.id:this.onGainAstralFireStacks(3,!1);break;case this.data.actions.FLARE.id:this.tryConsumeUmbralHearts(3,!0),this.onGainAstralFireStacks(3,!1);break;case this.data.actions.XENOGLOSSY.id:case this.data.actions.FOUL.id:this.onConsumePolyglot();break;case this.data.actions.TRANSPOSE.id:this.onTransposeStacks();break;case this.data.actions.PARADOX.id:this.handleParadox(t);break;case this.data.actions.AMPLIFIER.id:this.onGeneratePolyglot()}}},{key:"addEvent",value:function(){!this.astralFireGauge.empty&&this.astralFireTimer.expired&&this.astralFireTimer.start(),!this.umbralIceGauge.empty&&this.umbralIceTimer.expired&&this.umbralIceTimer.start(),this.astralFireTimer.expired&&this.umbralIceTimer.expired||!this.polyglotTimer.expired||this.polyglotTimer.start(),this.gaugeValuesChanged(this.previousGaugeState)&&(this.tryGainParadox(this.previousGaugeState),this.updateCastTimes(this.previousGaugeState),this.previousGaugeState=this.getGaugeState(this.parser.currentEpochTimestamp),this.parser.queueEvent({type:"blmgauge",timestamp:this.parser.currentEpochTimestamp}))}},{key:"gaugeValuesChanged",value:function(t){return t.astralFire!==this.astralFireGauge.value||t.umbralIce!==this.umbralIceGauge.value||t.umbralHearts!==this.umbralHeartsGauge.value||t.polyglot!==this.polyglotGauge.value||t.paradox!==this.paradoxGauge.value}},{key:"updateCastTimes",value:function(t){var e=t.astralFire,a=t.umbralIce;3!==e&&3===this.astralFireGauge.value&&(this.castTime.reset(this.castTimeIndex),this.castTimeIndex=this.castTime.setPercentageAdjustment(this.iceSpellIds,.5)),3!==a&&3===this.umbralIceGauge.value&&(this.castTime.reset(this.castTimeIndex),this.castTimeIndex=this.castTime.setPercentageAdjustment(this.fireSpellIds,.5)),3!==this.astralFireGauge.value&&3!==this.umbralIceGauge.value&&(this.castTime.reset(this.castTimeIndex),this.castTimeIndex=null),this.umbralIceGauge.empty||null!=this.paradoxInstantIndex||(this.paradoxInstantIndex=this.castTime.setInstantCastAdjustment([this.data.actions.PARADOX.id])),this.umbralIceGauge.empty&&null!=this.paradoxInstantIndex&&(this.castTime.reset(this.paradoxInstantIndex),this.paradoxInstantIndex=null)}},{key:"tryGainParadox",value:function(t){(3===t.umbralIce&&!this.astralFireGauge.empty&&this.umbralHeartsGauge.capped||3===t.astralFire&&!this.umbralIceGauge.empty)&&this.paradoxGauge.generate(1)}},{key:"onAstralUmbralTimeout",value:function(t){this.onAstralUmbralEnd(!0)}},{key:"onAstralUmbralEnd",value:function(t){this.astralFireTimer.reset(),this.astralFireGauge.reset(),this.umbralIceTimer.reset(),this.umbralIceGauge.reset(),this.onEnochianTimeout(t)}},{key:"onGainAstralFireStacks",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!this.umbralIceGauge.empty&&e?this.onAstralUmbralEnd(!0):(this.umbralIceTimer.reset(),this.umbralIceGauge.reset(),this.astralFireTimer.start(),this.astralFireGauge.generate(t),this.addEvent())}},{key:"onGainUmbralIceStacks",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!this.astralFireGauge.empty&&e?this.onAstralUmbralEnd(!0):(this.astralFireTimer.reset(),this.astralFireGauge.reset(),this.umbralIceTimer.start(),this.umbralIceGauge.generate(t),this.addEvent())}},{key:"onTransposeStacks",value:function(){this.astralFireGauge.empty&&this.umbralIceGauge.empty||(this.astralFireGauge.empty?this.onGainAstralFireStacks(1,!1):this.onGainUmbralIceStacks(1,!1),this.addEvent())}},{key:"tryGainUmbralHearts",value:function(t){this.umbralIceGauge.empty||(this.umbralHeartsGauge.generate(t),this.addEvent())}},{key:"tryConsumeUmbralHearts",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.umbralHeartsGauge.empty||this.astralFireGauge.empty&&!e||(this.umbralHeartsGauge.spend(t),this.addEvent())}},{key:"onEnochianTimeout",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.polyglotTimer.active&&t&&this.droppedEnoTimestamps.push(this.parser.currentEpochTimestamp),this.polyglotTimer.reset(),this.umbralHeartsGauge.reset(),this.addEvent()}},{key:"onPolyglotTimerComplete",value:function(){this.polyglotTimer.refresh(),this.onGeneratePolyglot()}},{key:"onGeneratePolyglot",value:function(){this.polyglotGauge.capped&&this.overwrittenPolyglot++,this.polyglotGauge.generate(1),this.addEvent()}},{key:"onConsumePolyglot",value:function(){this.polyglotGauge.empty&&this.overwrittenPolyglot>0&&this.overwrittenPolyglot--,this.polyglotGauge.spend(1),this.addEvent()}},{key:"countLostPolyglots",value:function(t){return Math.floor(t/Ce)}},{key:"handleParadox",value:function(t){"action"===t.type?this.paradoxGauge.spend(1):"damage"===t.type&&(this.umbralIceTimer.expired||this.onGainUmbralIceStacks(1),this.astralFireTimer.expired||this.onGainAstralFireStacks(1))}},{key:"onDeath",value:function(){this.onAstralUmbralEnd(!1)}},{key:"onComplete",value:function(){var t,e,a=this,s=this.parser.pull.timestamp+this.data.actions.FIRE_IV.castTime,i=me()(t=this.unableToAct.getWindows()).call(t,(function(t){return Math.max(0,t.end-t.start)>=Pe})),n=this.data.actions.BLIZZARD_III.castTime+1e3,r=this.polyglotTimer.getExpirationTime(s,this.parser.currentEpochTimestamp,i,n),o=this.countLostPolyglots(r),l=me()(e=this.droppedEnoTimestamps).call(e,(function(t){var e;return 0===me()(e=a.unableToAct.getWindows({start:t,end:t})).call(e,(function(t){return Math.max(0,t.end-t.start)>=Pe})).length})).length;l>0&&this.suggestions.add(new xe.q$({icon:this.data.actions.FOUL.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.suggestions.dropped-enochian.content",defaults:"Dropping Astral Fire or Umbral Ice may lead to lost <0/> or <1/> casts.",components:[(0,ke.jsx)(ye.P9,{action:"XENOGLOSSY"}),(0,ke.jsx)(ye.P9,{action:"FOUL"})]}),severity:xe.bI.MEDIUM,why:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.suggestions.dropped-enochian.why",defaults:"Astral Fire or Umbral Ice was dropped {droppedEno, plural, one {# time} other {# times}}.",values:{droppedEno:l}})})),o>0&&this.suggestions.add(new xe.q$({icon:this.data.actions.XENOGLOSSY.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.suggestions.lost-polyglot.content",defaults:"You lost Polyglot due to dropped Astral Fire or Umbral Ice. <0/> and <1/> are your strongest GCDs, so always maximize their casts.",components:[(0,ke.jsx)(ye.P9,{action:"XENOGLOSSY"}),(0,ke.jsx)(ye.P9,{action:"FOUL"})]}),severity:xe.bI.MAJOR,why:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.suggestions.lost-polyglot.why",defaults:"{lostPolyglot, plural, one {# Polyglot stack was} other {# Polyglot stacks were}} lost.",values:{lostPolyglot:o}})})),this.overwrittenPolyglot>0&&this.suggestions.add(new xe.q$({icon:this.data.actions.XENOGLOSSY.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.suggestions.overwritten-polyglot.content",defaults:"You overwrote Polyglot due to not casting <0/> or <1/> for 30s after gaining a second stack. <2/> and <3/> are your strongest GCDs, so always maximize their casts.",components:[(0,ke.jsx)(ye.P9,{action:"XENOGLOSSY"}),(0,ke.jsx)(ye.P9,{action:"FOUL"}),(0,ke.jsx)(ye.P9,{action:"XENOGLOSSY"}),(0,ke.jsx)(ye.P9,{action:"FOUL"})]}),severity:xe.bI.MAJOR,why:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.suggestions.overwritten-polyglot.why",defaults:"<0/> got overwritten {0, plural, one {# time} other {# times}}.",values:{0:this.overwrittenPolyglot},components:[(0,ke.jsx)(ye.P9,{showIcon:!1,action:"XENOGLOSSY"})]})})),this.paradoxGauge.overCap>0&&this.suggestions.add(new xe.q$({icon:this.data.actions.PARADOX.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.gauge.suggestions.overwritten-paradox.content",defaults:"You overwrote <0/> by generating a new marker without using the previous one. <1/> is a strong filler spell, so be sure to use it before generating a new one.",components:[(0,ke.jsx)(ye.P9,{action:"PARADOX"}),(0,ke.jsx)(ye.P9,{showIcon:!1,action:"PARADOX"})]}),severity:xe.bI.MAJOR,why:(0,ke.jsx)(ge.Trans,{id:"blm.gage.suggestions.overwritten-paradox.why",defaults:"<0/> got overwritten {0, plural, one {# time} other {# times}}.",values:{0:this.paradoxGauge.overCap},components:[(0,ke.jsx)(ye.P9,{showIcon:!1,action:"PARADOX"})]})}))}}]),a}(Te.aC),p.handle="gauge",p.title={id:"blm.gauge.title",defaults:"Gauge"},c=m,u=(0,oe.Z)(c.prototype,"suggestions",[be.I,r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.suggestions}}),d=(0,oe.Z)(c.prototype,"unableToAct",[be.I,o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.unableToAct}}),h=(0,oe.Z)(c.prototype,"castTime",[be.I,l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.castTime}}),c),We=a(97530),Be=a(99021),Ve=a(32366),ze=a.n(Ve),Ye=a(28683),Xe=a(52102),qe=a(73947),Je=a(56611),$e=a(65927),Ke=a(80967),Qe=(g=Reflect.metadata("design:type",qe.V),f=Reflect.metadata("design:type",Xe.ZP),v=Reflect.metadata("design:type",Je.TY),y=Reflect.metadata("design:type",ae.Z),Z=w=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return s=e.call.apply(e,Jt()(t=[this]).call(t,n)),(0,ne.Z)(s,"data",b,(0,re.Z)(s)),(0,ne.Z)(s,"checklist",T,(0,re.Z)(s)),(0,ne.Z)(s,"timeline",x,(0,re.Z)(s)),(0,ne.Z)(s,"castTime",E,(0,re.Z)(s)),s.leyLinesStatuses=[s.data.statuses.LEY_LINES.id,s.data.statuses.CIRCLE_OF_POWER.id],s.buffWindows={},s.castTimeIndex=null,s}return(0,Kt.Z)(a,[{key:"initialise",value:function(){var t=this,e=(0,ee.hX)().source(this.parser.actor.id).status((0,ee.kw)(this.leyLinesStatuses));this.addEventHook(e.type("statusApply"),this.onGain),this.addEventHook(e.type("statusRemove"),this.onDrop),this.addEventHook({type:"death",actor:this.parser.actor.id},this.onDeath),this.addEventHook("complete",this.onComplete),this.leyLinesStatuses.forEach((function(e){t.buffWindows[e]={history:[]}}))}},{key:"getStatusDurationInRange",value:function(t){var e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.parser.pull.timestamp,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.parser.pull.timestamp+this.parser.pull.duration,i=0,n=(0,Be.Z)(this.buffWindows[t].history);try{for(n.s();!(e=n.n()).done;){var r=e.value;null==r.stop||r.stop<=a||r.start>=s||(i+=Math.max(0,Math.min(r.stop,s)-Math.max(r.start,a)))}}catch(t){n.e(t)}finally{n.f()}var o=this.buffWindows[t].current;return null!=o&&(i+=Math.max(s-Math.max(o.start,a),0)),i}},{key:"onGain",value:function(t){var e=this.data.getStatus(t.status);if(e){var a=this.buffWindows[e.id];a.current||(a.current={start:t.timestamp},e.id===this.data.statuses.CIRCLE_OF_POWER.id&&(this.castTimeIndex=this.castTime.setPercentageAdjustment("all",this.data.statuses.CIRCLE_OF_POWER.speedModifier,"both")))}}},{key:"onDrop",value:function(t){this.stopAndSave(t.status,t.timestamp)}},{key:"onDeath",value:function(t){this.stopAndSave(this.data.statuses.LEY_LINES.id,t.timestamp)}},{key:"stopAndSave",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.parser.currentEpochTimestamp,a=this.buffWindows[t];a.current&&(a.current.stop=e,a.history.push(a.current),a.current=void 0,t===this.data.statuses.LEY_LINES.id&&this.stopAndSave(this.data.statuses.CIRCLE_OF_POWER.id,e),t===this.data.statuses.CIRCLE_OF_POWER.id&&(this.castTime.reset(this.castTimeIndex),this.castTimeIndex=null))}},{key:"dontMovePercent",value:function(t,e){return t/e*100}},{key:"onComplete",value:function(){var t=this;this.stopAndSave(this.data.statuses.LEY_LINES.id);var e=this.timeline.addRow(new Je.e2({label:"Ley Lines Buffs",order:0})),a=this.parser.pull.timestamp;this.leyLinesStatuses.forEach((function(s){var i=t.data.getStatus(s);if(i){var n=e.addRow(new Je.e2({label:i.name}));t.buffWindows[s].history.forEach((function(t){t.stop&&n.addItem(new Je.hg({status:i,start:t.start-a,end:t.stop-a}))}))}}));var s=this.getStatusDurationInRange(this.data.statuses.CIRCLE_OF_POWER.id),i=this.getStatusDurationInRange(this.data.statuses.LEY_LINES.id);this.checklist.add(new Xe.$9({name:(0,ke.jsx)(ge.Trans,{id:"blm.leylines.checklist-caption",defaults:"Stay in your <0/>",components:[(0,ke.jsx)(ye.vm,(0,We.Z)({},this.data.actions.LEY_LINES))]}),description:(0,ke.jsx)(ge.Trans,{id:"blm.leylines.checklist",defaults:"Try to avoid leaving your <0/> after placing them. Take advantage of <1/>' size to stay in them while dodging AOEs and being in range of healers. If you can't stay in them for the majority of a <2/>' duration, consider changing where they're placed in the fight.",components:[(0,ke.jsx)(ye.vm,(0,We.Z)({showIcon:!1},this.data.actions.LEY_LINES)),(0,ke.jsx)(ye.vm,(0,We.Z)({showIcon:!1},this.data.actions.LEY_LINES)),(0,ke.jsx)(ye.vm,(0,We.Z)({showIcon:!1},this.data.actions.LEY_LINES))]}),requirements:[new Xe.nb({name:(0,ke.jsx)(ye.vm,(0,We.Z)({},this.data.actions.LEY_LINES)),percent:this.dontMovePercent(s,i)})],target:90}))}},{key:"output",value:function(){var t,e=this,a=this.parser.pull.timestamp+this.parser.pull.duration;return(0,ke.jsxs)($e.Z,{collapsing:!0,unstackable:!0,compact:"very",children:[(0,ke.jsx)($e.Z.Header,{children:(0,ke.jsxs)($e.Z.Row,{children:[(0,ke.jsx)($e.Z.HeaderCell,{children:(0,ke.jsx)(ge.Trans,{id:"blm.leylines.timestamp-header",defaults:"Timestamp"})}),(0,ke.jsx)($e.Z.HeaderCell,{children:(0,ke.jsx)(ge.Trans,{id:"blm.leylines.uptime-header",defaults:"Uptime"})}),(0,ke.jsx)($e.Z.HeaderCell,{})]})}),(0,ke.jsx)($e.Z.Body,{children:ue()(t=this.buffWindows[this.data.statuses.LEY_LINES.id].history).call(t,(function(t){var s,i=me()(s=e.buffWindows[e.data.statuses.CIRCLE_OF_POWER.id].history).call(s,(function(e){return e.start>=t.start&&(e.stop||0)<=(t.stop||0)})),n=ze()(i).call(i,(function(t,e){return t+Math.max((e.stop||0)-e.start,0)}),0),r=e.dontMovePercent(n,(t.stop||a)-t.start).toFixed(2);return(0,ke.jsxs)($e.Z.Row,{children:[(0,ke.jsx)($e.Z.Cell,{children:e.parser.formatEpochTimestamp(t.start)}),(0,ke.jsxs)($e.Z.Cell,{children:[r,"%"]}),(0,ke.jsx)($e.Z.Cell,{children:(0,ke.jsx)(Ke.Z,{onClick:function(){return e.timeline.show(t.start-e.parser.pull.timestamp,(t.stop||a)-e.parser.pull.timestamp)},children:(0,ke.jsx)(ge.Trans,{id:"blm.leylines.timelinelink-button",defaults:"Jump to Timeline"})})})]},t.start)}))})]})}}]),a}(Ye.qk),w.handle="leylines",w.title={id:"blm.leylines.title",defaults:"Ley Lines"},w.displayOrder=3,I=Z,b=(0,oe.Z)(I.prototype,"data",[be.I,g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.data}}),T=(0,oe.Z)(I.prototype,"checklist",[be.I,f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.checklist}}),x=(0,oe.Z)(I.prototype,"timeline",[be.I,v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.timeline}}),E=(0,oe.Z)(I.prototype,"castTime",[be.I,y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.castTime}}),I),ta=a(51691),ea=a(83459),aa=150,sa=(R=Reflect.metadata("design:type",Je.TY),A=Reflect.metadata("design:type",ea.E),S=Reflect.metadata("design:type",ta.Z),F=D=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return s=e.call.apply(e,Jt()(t=[this]).call(t,n)),(0,ne.Z)(s,"timeline",k,(0,re.Z)(s)),(0,ne.Z)(s,"gcd",C,(0,re.Z)(s)),(0,ne.Z)(s,"downtime",P,(0,re.Z)(s)),s.noCastWindows={history:[]},s.hardCast=!1,s}return(0,Kt.Z)(a,[{key:"initialise",value:function(){var t=(0,ee.hX)().source(this.parser.actor.id);this.addEventHook(t.type("prepare"),this.onBegin),this.addEventHook(t.type("action"),this.onCast),this.addEventHook({type:"death",actor:this.parser.actor.id},this.onDeath),this.addEventHook("complete",this.onComplete)}},{key:"onCast",value:function(t){var e=this.gcd.getDuration(),a=t.timestamp;this.hardCast&&(a=t.timestamp+500,this.hardCast=!1),this.noCastWindows.current?(a-this.noCastWindows.current.start>e+aa&&this.stopAndSave(a),this.noCastWindows.current={start:a}):this.noCastWindows.current={start:a}}},{key:"onBegin",value:function(t){var e=this.gcd.getDuration();this.noCastWindows.current&&(t.timestamp-this.noCastWindows.current.start>e+aa&&this.stopAndSave(t.timestamp),this.noCastWindows.current=void 0,this.hardCast=!0)}},{key:"onDeath",value:function(){this.noCastWindows.current=void 0}},{key:"stopAndSave",value:function(t){var e=this.noCastWindows;e.current&&(e.current.stop=t,e.history.push(e.current),e.current=void 0)}},{key:"onComplete",value:function(t){var e,a=this,s=this.gcd.getDuration();this.stopAndSave(t.timestamp),this.noCastWindows.history=me()(e=this.noCastWindows.history).call(e,(function(t){var e,i;return 0===a.downtime.getDowntime(t.start,null!==(e=t.stop)&&void 0!==e?e:t.start)&&(null!==(i=t.stop)&&void 0!==i?i:t.start)-t.start>s+aa}))}},{key:"output",value:function(){var t,e=this,a=this.gcd.getDuration();if(0!==this.noCastWindows.history.length)return(0,ke.jsxs)($e.Z,{collapsing:!0,unstackable:!0,compact:"very",children:[(0,ke.jsx)($e.Z.Header,{children:(0,ke.jsxs)($e.Z.Row,{children:[(0,ke.jsx)($e.Z.HeaderCell,{children:(0,ke.jsx)(ge.Trans,{id:"blm.notcasting.timestamp-header",defaults:"Timestamp"})}),(0,ke.jsx)($e.Z.HeaderCell,{children:(0,ke.jsx)(ge.Trans,{id:"blm.notcasting.duration-header",defaults:"Duration"})}),(0,ke.jsx)($e.Z.HeaderCell,{})]})}),(0,ke.jsx)($e.Z.Body,{children:ue()(t=this.noCastWindows.history).call(t,(function(t){var s;return(0,ke.jsxs)($e.Z.Row,{children:[(0,ke.jsx)($e.Z.Cell,{children:e.parser.formatEpochTimestamp(t.start)}),(0,ke.jsxs)($e.Z.Cell,{children:["≥",e.parser.formatDuration((null!==(s=t.stop)&&void 0!==s?s:t.start)-t.start-a-aa)]}),(0,ke.jsx)($e.Z.Cell,{children:(0,ke.jsx)(Ke.Z,{onClick:function(){var a;return e.timeline.show(t.start-e.parser.pull.timestamp,(null!==(a=t.stop)&&void 0!==a?a:t.start)-e.parser.pull.timestamp)},children:(0,ke.jsx)(ge.Trans,{id:"blm.notcasting.timelinelink-button",defaults:"Jump to Timeline"})})})]},t.start)}))})]})}}]),a}(Ye.qk),D.handle="notcasting",D.title={id:"blm.notcasting.title",defaults:"Times you did literally nothing"},D.displayOrder=2,j=F,k=(0,oe.Z)(j.prototype,"timeline",[be.I,R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.timeline}}),C=(0,oe.Z)(j.prototype,"gcd",[be.I,A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.gcd}}),P=(0,oe.Z)(j.prototype,"downtime",[be.I,S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.downtime}}),j),ia=a(48945),na=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(s=e.call.apply(e,Jt()(t=[this]).call(t,n))).defaultAllowedAverageDowntime=5e3,s.defaultFirstUseOffset=15e3,s.trackedCds=[{cooldowns:[s.data.actions.LEY_LINES]},{cooldowns:[s.data.actions.MANAFONT],firstUseOffset:25e3},{cooldowns:[s.data.actions.TRIPLECAST]},{cooldowns:[s.data.actions.AMPLIFIER]},{cooldowns:[s.data.actions.SHARPCAST]}],s.checklistTarget=95,s.checklistDescription=(0,ke.jsx)(ge.Trans,{id:"blm.ogcd-downtime.ogcd-cd-metric",defaults:"Always make sure to use your OGCDs when they are up but don't clip them. Utilize your procs or fast Blizzard IIIs or Fire IIIs to weave them. To account for random factors you are given a buffer of {0} seconds per instance to hold your cooldowns.",values:{0:5}}),s}return a}(ia.u),ra=a(24950),oa=(_=Reflect.metadata("design:type",ae.Z),G=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return s=e.call.apply(e,Jt()(t=[this]).call(t,n)),(0,ne.Z)(s,"castTime",O,(0,re.Z)(s)),s.trackedProcs=[{procStatus:s.data.statuses.THUNDERCLOUD,consumeActions:[s.data.actions.THUNDER_III,s.data.actions.THUNDER_IV]},{procStatus:s.data.statuses.FIRESTARTER,consumeActions:[s.data.actions.FIRE_III]}],s.hasSharpcast=!1,s}return(0,Kt.Z)(a,[{key:"initialise",value:function(){var t=this;(0,Qt.Z)((0,te.Z)(a.prototype),"initialise",this).call(this);var e=(0,ee.hX)().target(this.parser.actor.id).status(this.data.statuses.SHARPCAST.id);this.addEventHook(e.type("statusApply"),(function(){t.hasSharpcast=!0})),this.addEventHook(e.type("statusRemove"),(function(){t.hasSharpcast=!1}))}},{key:"jobSpecificCheckConsumeProc",value:function(t,e){return!(null!=this.castingSpellId&&this.castingSpellId===e.action)}},{key:"jobSpecificOnConsumeProc",value:function(t,e){this.castTime.setInstantCastAdjustment([e.action],e.timestamp,e.timestamp),e.action!==this.data.actions.THUNDER_III.id&&e.action!==this.data.actions.THUNDER_IV.id||!this.hasSharpcast||this.tryAddEventToRemovals(t,e)}},{key:"addJobSpecificSuggestions",value:function(){var t=this.getDropCountForStatus(this.data.statuses.THUNDERCLOUD.id);t>0&&this.suggestions.add(new xe.q$({icon:"/icon/action/t3p.png",content:(0,ke.jsx)(ge.Trans,{id:"blm.procs.suggestions.dropped-t3ps.content",defaults:"You lost at least one <0/> proc by allowing <1/> to expire without using it.",components:[(0,ke.jsx)(ye.vm,(0,We.Z)({},this.data.actions.THUNDER_III)),(0,ke.jsx)(ye.ci,(0,We.Z)({},this.data.statuses.THUNDERCLOUD))]}),severity:xe.bI.MEDIUM,why:(0,ke.jsx)(ge.Trans,{id:"blm.procs.suggestions.dropped-t3ps.why",defaults:"{droppedThunderClouds, plural, one {# Thundercloud proc} other {# Thundercloud procs}} expired.",values:{droppedThunderClouds:t}})}));var e=this.getDropCountForStatus(this.data.statuses.FIRESTARTER.id);e>0&&this.suggestions.add(new xe.q$({icon:"/icon/action/f3p.png",content:(0,ke.jsx)(ge.Trans,{id:"blm.procs.suggestions.dropped-f3ps.content",defaults:"You lost at least  one <0/> proc by allowing <1/> to expire without using it.",components:[(0,ke.jsx)(ye.vm,(0,We.Z)({},this.data.actions.FIRE_III)),(0,ke.jsx)(ye.ci,(0,We.Z)({},this.data.statuses.FIRESTARTER))]}),severity:xe.bI.MEDIUM,why:(0,ke.jsx)(ge.Trans,{id:"blm.procs.suggestions.dropped-f3ps.why",defaults:"{droppedFireStarters, plural, one {# Firestarter proc} other {# Firestarter procs}} expired.",values:{droppedFireStarters:e}})}))}}]),a}(ra.Q),O=(0,oe.Z)(G.prototype,"castTime",[be.I,_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.castTime}}),G),la=a(73905),ca=a(70273),ua=a(90577),da=a(68156),ha=a(45150),pa={1:xe.bI.MINOR,3:xe.bI.MEDIUM,5:xe.bI.MAJOR},ma={1:xe.bI.MINOR,2:xe.bI.MEDIUM,3:xe.bI.MAJOR},ga=["BLIZZARD_III","TRANSPOSE","BLIZZARD_II","HIGH_BLIZZARD_II"],fa=(0,Ze.mD)()({NO_ERROR:{priority:0,message:"No errors"},FINAL_OR_DOWNTIME:{priority:1,message:"Ended with downtime, or last cycle"},SHORT:{priority:2,message:"Too short, won't process"},SHOULD_SKIP_T3:{priority:8,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.should-skip-t3",defaults:"Should skip hardcast <0/>",components:[(0,ke.jsx)(ye.P9,{action:"THUNDER_III"})]})},SHOULD_SKIP_B4:{priority:9,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.should-skip-b4",defaults:"Should skip <0/>",components:[(0,ke.jsx)(ye.P9,{action:"BLIZZARD_IV"})]})},MISSING_FIRE4S:{priority:10,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.missing-fire4s",defaults:"Missing one or more <0/>s",components:[(0,ke.jsx)(ye.P9,{action:"FIRE_IV"})]})},MISSED_ICE_PARADOX:{priority:15,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.missed-ice-paradox",defaults:"Missed <0/> in Umbral Ice",components:[(0,ke.jsx)(ye.P9,{action:"PARADOX"})]})},MISSING_DESPAIRS:{priority:20,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.missing-despair",defaults:"Missing one or more <0/>s",components:[(0,ke.jsx)(ye.P9,{action:"DESPAIR"})]})},MANAFONT_BEFORE_DESPAIR:{priority:40,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.manafont-before-despair",defaults:"<0/> used before <1/>",components:[(0,ke.jsx)(ye.P9,{action:"MANAFONT"}),(0,ke.jsx)(ye.P9,{action:"DESPAIR"})]})},EXTRA_T3:{priority:59,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.extra-t3",defaults:"Extra <0/>s",components:[(0,ke.jsx)(ye.P9,{action:"THUNDER_III"})]})},EXTRA_F1:{priority:60,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.extra-f1",defaults:"Extra <0/>",components:[(0,ke.jsx)(ye.P9,{action:"FIRE_I"})]})},NO_FIRE_SPELLS:{priority:80,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.no-fire-spells",defaults:"Rotation included no Fire spells"})},DROPPED_AF_UI:{priority:100,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.dropped-astral-umbral",defaults:"Dropped Astral Fire or Umbral Ice"})},DIED:{priority:101,message:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.error-messages.died",defaults:"<0/> Died",components:[(0,ke.jsx)(ye.P9,{showName:!1,action:"RAISE"})]})}}),va=function(){function t(e,a,s,i){(0,zt.Z)(this,t),this.data=void 0,this.fireSpellIds=[],this.unaspectedEvents=[],this.icePhaseEvents=[],this.firePhaseEvents=[],this.manafontPhaseEvents=[],this.startTime=void 0,this.endTime=void 0,this.firePhaseMetadata=void 0,this.finalOrDowntime=!1,this._errorCode=fa.NO_ERROR,this.startTime=e,this.firePhaseMetadata={startTime:0,initialMP:0,circleOfPowerPct:0,initialGaugeState:(0,We.Z)({},a)},this.data=s,this.fireSpellIds=i}return(0,Kt.Z)(t,[{key:"fullFirePhaseEvents",get:function(){var t;return Jt()(t=this.firePhaseEvents).call(t,this.manafontPhaseEvents)}},{key:"events",get:function(){var t,e;return Jt()(t=Jt()(e=this.unaspectedEvents).call(e,this.icePhaseEvents)).call(t,this.fullFirePhaseEvents)}},{key:"errorCode",get:function(){return this._errorCode},set:function(t){t.priority>this._errorCode.priority&&(this._errorCode=t)}},{key:"expectedFire4s",get:function(){if(!this.finalOrDowntime)return this.expectedFire4sBeforeDespair+(this.hasManafont?1:0)}},{key:"expectedFire4sBeforeDespair",get:function(){var t=4;return this.firePhaseMetadata.initialGaugeState.umbralHearts>0&&t++,3===this.firePhaseMetadata.initialGaugeState.umbralHearts&&t++,4===t&&this.icePhaseEvents.length>0&&this.firePhaseMetadata.circleOfPowerPct>=.5&&t++,Math.min(t,6)}},{key:"actualFire4s",get:function(){var t,e=this;return me()(t=this.events).call(t,(function(t){return t.action===e.data.actions.FIRE_IV.id})).length}},{key:"missingFire4s",get:function(){if(this.expectedFire4s)return Math.max(this.expectedFire4s-this.actualFire4s,0)}},{key:"expectedDespairs",get:function(){return this.hasManafont?2:1}},{key:"actualDespairs",get:function(){var t,e=this;return me()(t=this.events).call(t,(function(t){return t.action===e.data.actions.DESPAIR.id})).length}},{key:"missingDespairs",get:function(){return Math.max(this.expectedDespairs-this.actualDespairs,0)}},{key:"hardT3sInPhase",value:function(t){var e=this;return me()(t).call(t,(function(t){return t.action===e.data.actions.THUNDER_III.id&&!t.isProc})).length}},{key:"hardT3sBeforeManafont",get:function(){return this.hardT3sInPhase(this.firePhaseEvents)}},{key:"hardT3sAfterManafont",get:function(){return this.hardT3sInPhase(this.manafontPhaseEvents)}},{key:"hardT3sInFireCount",get:function(){return this.hardT3sBeforeManafont+this.hardT3sAfterManafont}},{key:"extraT3s",get:function(){var t=this;if(!this.missingFire4s&&!this.missingDespairs)return 0;var e=2*(this.expectedFire4sBeforeDespair*this.data.actions.FIRE_IV.mpCost+(this.fullFirePhaseEvents.some((function(e){return e.action===t.data.actions.FIRE_I.id||e.action===t.data.actions.PARADOX.id}))?1:0)*this.data.actions.FIRE_I.mpCost)-this.firePhaseMetadata.initialGaugeState.umbralHearts*this.data.actions.FIRE_IV.mpCost+this.data.actions.FIRE_IV.mpCost,a=Math.floor(Math.max(this.firePhaseMetadata.initialMP-e,0)/this.data.actions.THUNDER_III.mpCost);return Math.max(this.hardT3sBeforeManafont-a,0)+Math.max(this.hardT3sAfterManafont-1,0)}},{key:"hasManafont",get:function(){var t=this;return this.events.some((function(e){return e.action===t.data.actions.MANAFONT.id}))}},{key:"manafontBeforeDespair",get:function(){var t=this;return this.hasManafont&&!this.firePhaseEvents.some((function(e){return e.action===t.data.actions.DESPAIR.id}))}},{key:"extraF1s",get:function(){var t,e=this;return Math.max(me()(t=this.fullFirePhaseEvents).call(t,(function(t){return t.action===e.data.actions.FIRE_I.id||t.action===e.data.actions.PARADOX.id})).length-1,0)}},{key:"isMissingFire",get:function(){var t=this;return!this.events.some((function(e){var a;return he()(a=t.fireSpellIds).call(a,e.action)}))}},{key:"shouldSkipB4",get:function(){var t=this;return this.finalOrDowntime&&this.icePhaseEvents.some((function(e){return e.action===t.data.actions.BLIZZARD_IV.id}))&&this.actualFire4s<=4}},{key:"shouldSkipT3",get:function(){return this.finalOrDowntime&&this.hardT3sInFireCount>0}},{key:"includeInSuggestions",get:function(){return this.errorCode.priority<101&&this.errorCode.priority>2}},{key:"overrideErrorCode",value:function(t){this._errorCode=t}},{key:"addEvent",value:function(t){var e=this;t.gaugeContext.enochian?0===this.firePhaseMetadata.startTime?this.icePhaseEvents.push(t):this.firePhaseEvents.some((function(t){return t.action===e.data.actions.MANAFONT.id}))?this.manafontPhaseEvents.push(t):this.firePhaseEvents.push(t):this.unaspectedEvents.push(t)}}]),t}(),ya=(H=Reflect.metadata("design:type",xe.ZP),M=Reflect.metadata("design:type",ua.I),U=Reflect.metadata("design:type",Je.TY),L=Reflect.metadata("design:type",Ee.b),N=Reflect.metadata("design:type",ca.e),W=Reflect.metadata("design:type",Ne),B=Reflect.metadata("design:type",qe.V),V=Reflect.metadata("design:type",oa),z=Reflect.metadata("design:type",Qe),it=st=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return s=e.call.apply(e,Jt()(t=[this]).call(t,n)),(0,ne.Z)(s,"suggestions",X,(0,re.Z)(s)),(0,ne.Z)(s,"invulnerability",q,(0,re.Z)(s)),(0,ne.Z)(s,"timeline",J,(0,re.Z)(s)),(0,ne.Z)(s,"unableToAct",$,(0,re.Z)(s)),(0,ne.Z)(s,"actors",K,(0,re.Z)(s)),(0,ne.Z)(s,"gauge",Q,(0,re.Z)(s)),(0,ne.Z)(s,"data",tt,(0,re.Z)(s)),(0,ne.Z)(s,"procs",et,(0,re.Z)(s)),(0,ne.Z)(s,"leylines",at,(0,re.Z)(s)),s.currentGaugeState={astralFire:0,umbralIce:0,umbralHearts:0,polyglot:0,enochian:!1,paradox:0},s.cycleEndpointIds=ue()(ga).call(ga,(function(t){return s.data.actions[t].id})),s.fireSpellIds=ue()(Re).call(Re,(function(t){return s.data.actions[t].id})),s.currentRotation=new va(s.parser.pull.timestamp,s.currentGaugeState,s.data,s.fireSpellIds),s.history=[],s.firstEvent=!0,s.uptimeSouls=0,s}return(0,Kt.Z)(a,[{key:"initialise",value:function(){this.addEventHook({type:"action",source:this.parser.actor.id},this.onCast),this.addEventHook("complete",this.onComplete),this.addEventHook("blmgauge",this.onGaugeEvent),this.addEventHook({type:"death",actor:this.parser.actor.id},this.onDeath)}},{key:"onGaugeEvent",value:function(t){var e=this.gauge.getGaugeState(t.timestamp);0===this.currentGaugeState.astralFire&&e.astralFire>0&&(this.currentRotation.firePhaseMetadata.startTime=t.timestamp,this.currentRotation.firePhaseMetadata.initialMP=this.actors.current.mp.current,this.currentRotation.firePhaseMetadata.initialGaugeState=(0,We.Z)({},this.currentGaugeState)),this.currentGaugeState.enochian&&!e.enochian&&(this.currentRotation.errorCode=fa.DROPPED_AF_UI),this.currentGaugeState=(0,We.Z)({},e)}},{key:"onCast",value:function(t){var e,a=t.action;!he()(e=this.cycleEndpointIds).call(e,a)||this.firstEvent||a===this.data.actions.TRANSPOSE.id&&this.currentGaugeState.umbralIce>0||this.startRecording(t);var s=this.data.getAction(a);s&&!s.autoAttack&&(this.firstEvent&&s.onGcd&&(this.firstEvent=!1),this.currentRotation.addEvent((0,We.Z)((0,We.Z)({},t),{},{isProc:this.procs.checkEventWasProc(t),gaugeContext:(0,We.Z)({},this.currentGaugeState)})),a!==this.data.actions.UMBRAL_SOUL.id||this.invulnerability.isActive({types:["invulnerable"]})||this.uptimeSouls++)}},{key:"onDeath",value:function(){this.currentRotation.errorCode=fa.DIED}},{key:"onComplete",value:function(){var t,e,a,s,i,n,r,o,l=this;this.stopRecording(void 0);var c,u=(0,Be.Z)(this.history);try{for(u.s();!(c=u.n()).done;){var d,h=c.value;h.errorCode===fa.DROPPED_AF_UI&&me()(d=this.unableToAct.getWindows({start:h.startTime,end:h.endTime})).call(d,(function(t){return Math.max(0,t.end-t.start)>=Pe})).length>0&&h.overrideErrorCode(fa.FINAL_OR_DOWNTIME)}}catch(t){u.e(t)}finally{u.f()}this.history.forEach((function(t){var e;if(t.errorCode===fa.MISSING_FIRE4S){var a=null!==(e=t.endTime)&&void 0!==e?e:l.parser.pull.timestamp+l.parser.pull.duration;l.invulnerability.isActive({timestamp:a+l.data.actions.FIRE_IV.castTime,types:["invulnerable"]})&&(t.finalOrDowntime=!0,t.overrideErrorCode(fa.NO_ERROR),l.processCycle(t))}}));var p=me()(t=this.history).call(t,(function(t){return t.shouldSkipB4})).length;this.suggestions.add(new xe.eg({icon:this.data.actions.FIRE_IV.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.should-skip-b4.content",defaults:"You lost at least one <0/> by not skipping <1/> in an Umbral Ice phase before the fight finished or a phase transition occurred.",components:[(0,ke.jsx)(ye.P9,{action:"FIRE_IV"}),(0,ke.jsx)(ye.P9,{action:"BLIZZARD_IV"})]}),tiers:ma,value:p,why:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.should-skip-b4.why",defaults:"You should have skipped <0/> {shouldSkipB4s, plural, one {# time} other {# times}}.",values:{shouldSkipB4s:p},components:[(0,ke.jsx)(ye.P9,{showIcon:!1,action:"BLIZZARD_IV"})]})}));var m=ze()(e=me()(a=this.history).call(a,(function(t){return t.shouldSkipT3}))).call(e,(function(t,e){return t+e.hardT3sInFireCount}),0);this.suggestions.add(new xe.eg({icon:this.data.actions.FIRE_IV.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.should-skip-t3.content",defaults:"You lost at least one <0/> by hard casting <1/> before the fight finished or a phase transition occurred.",components:[(0,ke.jsx)(ye.P9,{action:"FIRE_IV"}),(0,ke.jsx)(ye.P9,{action:"THUNDER_III"})]}),tiers:ma,value:m,why:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.should-skip-t3.why",defaults:"You should have skipped <0/> {shouldSkipT3s, plural, one {# time} other {# times}}.",values:{shouldSkipT3s:m},components:[(0,ke.jsx)(ye.P9,{showIcon:!1,action:"THUNDER_III"})]})}));var g=ze()(s=this.history).call(s,(function(t,e){return t+e.extraF1s}),0);this.suggestions.add(new xe.eg({icon:this.data.actions.FIRE_I.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.extra-f1s.content",defaults:"Casting more than one <0/> per Astral Fire cycle is a crutch that should be avoided by better pre-planning of the encounter.",components:[(0,ke.jsx)(ye.P9,{action:"FIRE_I"})]}),tiers:pa,value:g,why:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.extra-f1s.why",defaults:"You cast an extra <0/> {extraF1s, plural, one {# time} other {# times}}.",values:{extraF1s:g},components:[(0,ke.jsx)(ye.P9,{showIcon:!1,action:"FIRE_I"})]})}));var f=me()(i=this.history).call(i,(function(t){return t.missingDespairs&&t.includeInSuggestions})).length;this.suggestions.add(new xe.eg({icon:this.data.actions.DESPAIR.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.end-with-despair.content",defaults:"Once you can no longer cast another spell in Astral Fire and remain above 800 MP, you should use your remaining MP by casting <0/>.",components:[(0,ke.jsx)(ye.P9,{action:"DESPAIR"})]}),tiers:pa,value:f,why:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.end-with-despair.why",defaults:"{astralFiresMissingDespairs, plural, one {# Astral Fire phase was} other {# Astral Fire phases were}} missing at least one <0/>.",values:{astralFiresMissingDespairs:f},components:[(0,ke.jsx)(ye.P9,{showIcon:!1,action:"DESPAIR"})]})}));var v=me()(n=this.history).call(n,(function(t){return t.manafontBeforeDespair})).length;this.suggestions.add(new xe.eg({icon:this.data.actions.MANAFONT.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.mf-before-despair.content",defaults:"Using <0/> before <1/> leads to fewer <2/>s than possible being cast. Try to avoid that since <3/> is stronger than <4/>.",components:[(0,ke.jsx)(ye.P9,{action:"MANAFONT"}),(0,ke.jsx)(ye.P9,{action:"DESPAIR"}),(0,ke.jsx)(ye.P9,{showIcon:!1,action:"DESPAIR"}),(0,ke.jsx)(ye.P9,{showIcon:!1,action:"DESPAIR"}),(0,ke.jsx)(ye.P9,{action:"FIRE_IV"})]}),tiers:ma,value:v,why:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.mf-before-despair.why",defaults:"<0/> was used before <1/> {manafontsBeforeDespair, plural, one {# time} other {# times}}.",values:{manafontsBeforeDespair:v},components:[(0,ke.jsx)(ye.P9,{showIcon:!1,action:"MANAFONT"}),(0,ke.jsx)(ye.P9,{action:"DESPAIR"})]})}));var y=ze()(r=this.history).call(r,(function(t,e){return t+e.extraT3s}),0);this.suggestions.add(new xe.eg({icon:this.data.actions.THUNDER_III.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.wrong-t3.content",defaults:"Don't hard cast more than one <0/> in your Astral Fire phase, since that costs MP which could be used for more <1/>s.",components:[(0,ke.jsx)(ye.P9,{action:"THUNDER_III"}),(0,ke.jsx)(ye.P9,{action:"FIRE_IV"})]}),tiers:pa,value:y,why:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.wrong-t3.why",defaults:"<0/> was hard casted under Astral Fire {extraT3s, plural, one {# extra time} other {# extra times}}.",values:{extraT3s:y},components:[(0,ke.jsx)(ye.P9,{showIcon:!1,action:"THUNDER_III"})]})}));var I=me()(o=this.history).call(o,(function(t){return t.isMissingFire&&t.includeInSuggestions&&!t.finalOrDowntime})).length;this.suggestions.add(new xe.eg({icon:this.data.actions.BLIZZARD_II.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.icemage.content",defaults:"Avoid spending significant amounts of time in Umbral Ice. The majority of your damage comes from your Astral Fire phase, so you should maximize the number of <0/>s cast during the fight.",components:[(0,ke.jsx)(ye.P9,{action:"FIRE_IV"})]}),tiers:pa,value:I,why:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.icemage.why",defaults:"{rotationsWithoutFire, plural, one {# rotation was} other {# rotations were}} performed with no fire spells.",values:{rotationsWithoutFire:I}})})),this.suggestions.add(new xe.eg({icon:this.data.actions.UMBRAL_SOUL.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.uptime-souls.content",defaults:"Avoid using <0/> when there is a target available to hit with a damaging ability. <1/> does no damage and prevents you from using other GCD skills. It should be reserved for downtime.",components:[(0,ke.jsx)(ye.P9,{action:"UMBRAL_SOUL"}),(0,ke.jsx)(ye.P9,{showIcon:!1,action:"UMBRAL_SOUL"})]}),tiers:pa,value:this.uptimeSouls,why:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.suggestions.uptime-souls.why",defaults:"<0/> was performed during uptime {0, plural, one {# time} other {# times}}.",values:{0:this.uptimeSouls},components:[(0,ke.jsx)(ye.P9,{showIcon:!1,action:"UMBRAL_SOUL"})]})}))}},{key:"startRecording",value:function(t){this.stopRecording(t),this.currentRotation=new va(t.timestamp,this.currentGaugeState,this.data,this.fireSpellIds)}},{key:"stopRecording",value:function(t){this.currentRotation.endTime=this.parser.currentEpochTimestamp,this.currentRotation.firePhaseMetadata.circleOfPowerPct=this.leylines.getStatusDurationInRange(this.data.statuses.CIRCLE_OF_POWER.id,this.currentRotation.firePhaseMetadata.startTime,this.currentRotation.endTime)/(this.currentRotation.endTime-this.currentRotation.firePhaseMetadata.startTime),(!t||t&&t.action===this.data.actions.TRANSPOSE.id&&this.invulnerability.isActive({timestamp:t.timestamp,types:["untargetable"]}))&&(this.currentRotation.finalOrDowntime=!0),this.processCycle(this.currentRotation),this.history.push(this.currentRotation)}},{key:"processCycle",value:function(t){t.events.length<=3?t.errorCode=fa.SHORT:(t.firePhaseMetadata.initialGaugeState.paradox>0&&3===t.firePhaseMetadata.initialGaugeState.umbralIce&&3===t.firePhaseMetadata.initialGaugeState.umbralHearts&&(t.errorCode=fa.MISSED_ICE_PARADOX),t.missingDespairs&&(t.errorCode=fa.MISSING_DESPAIRS),t.manafontBeforeDespair&&(t.errorCode=fa.MANAFONT_BEFORE_DESPAIR),t.extraF1s>0&&(t.errorCode=fa.EXTRA_F1),t.finalOrDowntime?this.processDowntimeCycle(t):this.processNormalCycle(t))}},{key:"processNormalCycle",value:function(t){t.extraT3s>0&&(t.errorCode=fa.EXTRA_T3),t.isMissingFire&&(t.errorCode=fa.NO_FIRE_SPELLS),t.missingFire4s&&(t.errorCode=fa.MISSING_FIRE4S)}},{key:"processDowntimeCycle",value:function(t){t.errorCode=fa.FINAL_OR_DOWNTIME,t.shouldSkipB4&&(t.errorCode=fa.SHOULD_SKIP_B4),t.hardT3sInFireCount>0&&(t.errorCode=fa.SHOULD_SKIP_T3)}},{key:"output",value:function(){var t,e=this,a=me()(t=this.history).call(t,(function(t){return t.errorCode.priority>2||!1}));if(a.length>0)return(0,ke.jsxs)(we.Fragment,{children:[(0,ke.jsx)(da.Z,{children:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.rotation-table.message",defaults:"The core of BLM consists of six casts of <0/>, two casts of <1/> and one cast <2/> per rotation.<3/>With <4/>, an extra cast each of <5/> and <6/> are expected.<7/>Avoid missing Fire IV casts where possible.",components:[(0,ke.jsx)(ye.P9,{action:"FIRE_IV"}),(0,ke.jsx)(ye.P9,{action:"PARADOX"}),(0,ke.jsx)(ye.P9,{action:"DESPAIR"}),(0,ke.jsx)("br",{}),(0,ke.jsx)(ye.P9,{action:"MANAFONT"}),(0,ke.jsx)(ye.P9,{action:"FIRE_IV"}),(0,ke.jsx)(ye.P9,{action:"DESPAIR"}),(0,ke.jsx)("br",{})]})}),(0,ke.jsxs)(da.Z,{warning:!0,icon:!0,children:[(0,ke.jsx)(ha.Z,{name:"warning sign"}),(0,ke.jsx)(da.Z.Content,{children:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.rotation-table.disclaimer",defaults:"This module assumes you are following the standard BLM playstyle.<0/>If you are following a non-standard playstyle, this report and many of the suggestions may not be applicable.",components:[(0,ke.jsx)("br",{})]})})]}),(0,ke.jsx)(la.y,{targets:[{header:(0,ke.jsx)(ye.P9,{showName:!1,action:"FIRE_IV"}),accessor:"fire4s"},{header:(0,ke.jsx)(ye.P9,{showName:!1,action:"DESPAIR"}),accessor:"despairs"}],notes:[{header:(0,ke.jsx)(ge.Trans,{id:"blm.rotation-watchdog.rotation-table.header.reason",defaults:"Why Outlier"}),accessor:"reason"}],data:ue()(a).call(a,(function(t){return{start:t.startTime-e.parser.pull.timestamp,end:null!=t.endTime?t.endTime-e.parser.pull.timestamp:t.startTime-e.parser.pull.timestamp,targetsData:{fire4s:{actual:t.actualFire4s,expected:t.expectedFire4s},despairs:{actual:t.actualDespairs,expected:t.expectedDespairs}},notesMap:{reason:(0,ke.jsx)(ke.Fragment,{children:t.errorCode.message})},rotation:t.events}})),onGoto:this.timeline.show})]})}}]),a}(Ye.qk),st.handle="RotationWatchdog",st.title={id:"blm.rotation-watchdog.title",defaults:"Rotation Outliers"},st.displayOrder=1,Y=it,X=(0,oe.Z)(Y.prototype,"suggestions",[be.I,H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.suggestions}}),q=(0,oe.Z)(Y.prototype,"invulnerability",[be.I,M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.invulnerability}}),J=(0,oe.Z)(Y.prototype,"timeline",[be.I,U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.timeline}}),$=(0,oe.Z)(Y.prototype,"unableToAct",[be.I,L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.unableToAct}}),K=(0,oe.Z)(Y.prototype,"actors",[be.I,N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.actors}}),Q=(0,oe.Z)(Y.prototype,"gauge",[be.I,W],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.gauge}}),tt=(0,oe.Z)(Y.prototype,"data",[be.I,B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.data}}),et=(0,oe.Z)(Y.prototype,"procs",[be.I,V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.procs}}),at=(0,oe.Z)(Y.prototype,"leylines",[be.I,z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.leylines}}),Y),Ia=["FIRE_I","THUNDER_III","THUNDER_IV","SCATHE","PARADOX"],ba=(nt=Reflect.metadata("design:type",qe.V),rt=Reflect.metadata("design:type",oa),ot=Reflect.metadata("design:type",xe.ZP),lt=Reflect.metadata("design:type",Ne),gt=mt=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return s=e.call.apply(e,Jt()(t=[this]).call(t,n)),(0,ne.Z)(s,"data",ut,(0,re.Z)(s)),(0,ne.Z)(s,"procs",dt,(0,re.Z)(s)),(0,ne.Z)(s,"suggestions",ht,(0,re.Z)(s)),(0,ne.Z)(s,"gauge",pt,(0,re.Z)(s)),s.buffWindows={history:[]},s.droppedSharpcasts=0,s.overwrittenSharpcasts=0,s.sharpedScathes=0,s.sharpcastConsumerIds=ue()(Ia).call(Ia,(function(t){return s.data.actions[t].id})),s}return(0,Kt.Z)(a,[{key:"initialise",value:function(){var t=(0,ee.hX)().source(this.parser.actor.id),e=t.status(this.data.statuses.SHARPCAST.id);this.addEventHook(e.type("statusRemove"),this.onRemoveSharpcast),this.addEventHook(e.type("statusApply"),this.onGainSharpcast),this.addEventHook(t.type("action").action((0,ee.kw)(this.sharpcastConsumerIds)),this.tryConsumeSharpcast),this.addEventHook({type:"death",actor:this.parser.actor.id},this.onDeath),this.addEventHook("complete",this.onComplete)}},{key:"onRemoveSharpcast",value:function(t){this.stopAndSave(t.timestamp)}},{key:"onGainSharpcast",value:function(t){null!=this.buffWindows.current&&this.overwrittenSharpcasts++,this.buffWindows.current={start:t.timestamp}}},{key:"tryConsumeSharpcast",value:function(t){var e=t.action;e===this.data.actions.PARADOX.id&&this.gauge.getGaugeState(t.timestamp).astralFire<=0||this.buffWindows.current&&(this.stopAndSave(t.timestamp,!1),e===this.data.actions.SCATHE.id&&this.sharpedScathes++)}},{key:"onDeath",value:function(t){this.stopAndSave(t.timestamp)}},{key:"stopAndSave",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parser.currentEpochTimestamp,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.buffWindows.current&&(this.buffWindows.current.stop=t,this.buffWindows.current.stop-this.buffWindows.current.start>=this.data.statuses.SHARPCAST.duration&&e&&this.droppedSharpcasts++,this.buffWindows.history.push(this.buffWindows.current),this.buffWindows.current=void 0)}},{key:"onComplete",value:function(){var t=this;this.buffWindows.current&&this.stopAndSave();var e=this.procs.getRowForStatus(this.data.statuses.SHARPCAST),a=this.parser.pull.timestamp;this.buffWindows.history.forEach((function(s){var i;e.addItem(new Je.hg({status:t.data.statuses.SHARPCAST,start:s.start-a,end:(null!==(i=s.stop)&&void 0!==i?i:s.start)-a}))})),this.suggestions.add(new xe.eg({icon:this.data.statuses.SHARPCAST.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.sharpcast.suggestions.dropped-sharpcasts.content",defaults:"You lost at least one guaranteed <0/> or <1/> proc by allowing <2/> to fall off.",components:[(0,ke.jsx)(ye.P9,{status:"THUNDERCLOUD"}),(0,ke.jsx)(ye.P9,{status:"FIRESTARTER"}),(0,ke.jsx)(ye.P9,{status:"SHARPCAST"})]}),tiers:{1:xe.bI.MINOR,3:xe.bI.MEDIUM,5:xe.bI.MAJOR},value:this.droppedSharpcasts,why:(0,ke.jsx)(ge.Trans,{id:"blm.sharpcast.suggestions.dropped-sharpcasts.why",defaults:"{0, plural, one {# Sharpcast} other {# Sharpcasts}} expired.",values:{0:this.droppedSharpcasts}})})),this.suggestions.add(new xe.eg({icon:this.data.actions.SCATHE.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.sharpcast.suggestions.sharpcasted-scathes.content",defaults:"You consumed at least one <0/> by using <1/>. While it's better than letting the buff expire, you should try to avoid doing so.",components:[(0,ke.jsx)(ye.P9,{status:"SHARPCAST"}),(0,ke.jsx)(ye.P9,{action:"SCATHE"})]}),tiers:{1:xe.bI.MINOR,4:xe.bI.MEDIUM,6:xe.bI.MAJOR},value:this.sharpedScathes,why:(0,ke.jsx)(ge.Trans,{id:"blm.sharpcast.suggestions.sharpcasted-scathes.why",defaults:"{0, plural, one {# Sharpcast was} other {# Sharpcasts were}} consumed by <0/>.",values:{0:this.sharpedScathes},components:[(0,ke.jsx)(ye.P9,{action:"SCATHE"})]})})),this.suggestions.add(new xe.eg({icon:this.data.actions.SHARPCAST.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.sharpcast.suggestions.overwrote-sharpcasts.content",defaults:"You lost at least one guaranteed <0/> or <1/> proc by using <2/> while the status was already active.",components:[(0,ke.jsx)(ye.P9,{status:"THUNDERCLOUD"}),(0,ke.jsx)(ye.P9,{status:"FIRESTARTER"}),(0,ke.jsx)(ye.P9,{action:"SHARPCAST"})]}),tiers:{1:xe.bI.MINOR,3:xe.bI.MEDIUM,5:xe.bI.MAJOR},value:this.overwrittenSharpcasts,why:(0,ke.jsx)(ge.Trans,{id:"blm.sharpcast.suggestions.overwrote-sharpcasts.why",defaults:"You overwrote <0/> {0, plural, one {# time} other {# times}}.",values:{0:this.overwrittenSharpcasts},components:[(0,ke.jsx)(ye.P9,{showIcon:!1,status:"SHARPCAST"})]})}))}}]),a}(Ye.qk),mt.handle="sharpcast",ct=gt,ut=(0,oe.Z)(ct.prototype,"data",[be.I,nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.data}}),dt=(0,oe.Z)(ct.prototype,"procs",[be.I,rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.procs}}),ht=(0,oe.Z)(ct.prototype,"suggestions",[be.I,ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.suggestions}}),pt=(0,oe.Z)(ct.prototype,"gauge",[be.I,lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.gauge}}),ct),Ta=a(44845),xa=a(86902),Ea=a.n(xa),wa=a(20455),Za=a.n(wa),Ra=a(40090),Aa=a(37487),Sa=a(32596),ja=a(30919),ka=(ft=Reflect.metadata("design:type",ca.e),vt=Reflect.metadata("design:type",Xe.ZP),yt=Reflect.metadata("design:type",qe.V),It=Reflect.metadata("design:type",ua.I),bt=Reflect.metadata("design:type",oa),Tt=Reflect.metadata("design:type",Sa.t),xt=Reflect.metadata("design:type",xe.ZP),Pt=Ct=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s,i;(0,zt.Z)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return i=e.call.apply(e,Jt()(t=[this]).call(t,r)),(0,ne.Z)(i,"actors",wt,(0,re.Z)(i)),(0,ne.Z)(i,"checklist",Zt,(0,re.Z)(i)),(0,ne.Z)(i,"data",Rt,(0,re.Z)(i)),(0,ne.Z)(i,"invulnerability",At,(0,re.Z)(i)),(0,ne.Z)(i,"procs",St,(0,re.Z)(i)),(0,ne.Z)(i,"statuses",jt,(0,re.Z)(i)),(0,ne.Z)(i,"suggestions",kt,(0,re.Z)(i)),i.STATUS_DURATION=(s={},(0,Ta.Z)(s,i.data.statuses.THUNDER_III.id,i.data.statuses.THUNDER_III.duration),(0,Ta.Z)(s,i.data.statuses.THUNDERCLOUD.id,i.data.statuses.THUNDERCLOUD.duration),s),i.thunder3Casts=0,i.lastThunderProc=!1,i.lastThunderCast=i.data.statuses.THUNDER_III.id,i.clip=(0,Ta.Z)({},i.data.statuses.THUNDER_III.id,0),i.tracker={},i}return(0,Kt.Z)(a,[{key:"initialise",value:function(){var t=(0,ee.hX)().source(this.parser.actor.id);this.addEventHook(t.type("action").action(this.data.actions.THUNDER_III.id),this.onDotCast),this.addEventHook(t.type("statusApply").status(this.data.statuses.THUNDER_III.id),this.onDotApply),this.addEventHook("complete",this.onComplete)}},{key:"createTargetApplicationList",value:function(){return(0,Ta.Z)({},this.data.statuses.THUNDER_III.id,[])}},{key:"pushApplication",value:function(t,e,a,s){var i=this.tracker[t]=this.tracker[t]||this.createTargetApplicationList(),n=this.lastThunderProc,r=this.lastThunderCast;i[e].applications.push({event:a,clip:s,source:r,proc:n}),this.lastThunderProc=!1}},{key:"onDotCast",value:function(t){this.thunder3Casts++,this.procs.checkEventWasProc(t)&&(this.lastThunderProc=!0),this.lastThunderCast=t.action}},{key:"onDotApply",value:function(t){var e=t.status,a=t.target,s=this.tracker[a]=this.tracker[a]||{};if(!s[e])return s[e]={lastApplication:t.timestamp,applications:[]},void this.pushApplication(a,e,t);var i=this.STATUS_DURATION[e]-(t.timestamp-s[e].lastApplication);i=Math.max(0,i),this.clip[e]+=i,this.pushApplication(a,e,t,i),s[e].lastApplication=t.timestamp}},{key:"getThunderUptime",value:function(){return this.statuses.getUptime(this.data.statuses.THUNDER_III,this.actors.foes)/(this.parser.currentDuration-this.invulnerability.getDuration({types:["invulnerable"]}))*100}},{key:"onComplete",value:function(){var t=this;this.checklist.add(new Xe.$9({name:(0,ke.jsx)(ge.Trans,{id:"blm.thunder.checklist.dots.name",defaults:"Keep your <0/> DoT up",components:[(0,ke.jsx)(ye.P9,{status:"THUNDER_III"})]}),description:(0,ke.jsx)(ge.Trans,{id:"blm.thunder.checklist.dots.description",defaults:"Your <0/> DoT contributes significantly to your overall damage, both on its own, and from additional <1/> procs. Try to keep the DoT applied.",components:[(0,ke.jsx)(ye.P9,{status:"THUNDER_III"}),(0,ke.jsx)(ye.P9,{status:"THUNDERCLOUD"})]}),target:95,requirements:[new Xe.nb({name:(0,ke.jsx)(ge.Trans,{id:"blm.thunder.checklist.dots.requirement.name",defaults:"<0/> uptime",components:[(0,ke.jsx)(ye.P9,{status:"THUNDER_III"})]}),percent:function(){return t.getThunderUptime()}})]}));var e=this.clip[this.data.statuses.THUNDER_III.id],s=3e3*(this.thunder3Casts-1);e>s&&this.suggestions.add(new xe.q$({icon:this.data.actions.THUNDER_III.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.thunder.suggestions.excess-thunder.content",defaults:"Casting <0/> too frequently can cause you to lose DPS by casting fewer <1/>. Try not to cast <2/> unless your <3/> DoT or <4/> proc are about to wear off. Check the <5><6/></5> module for more information.",components:[(0,ke.jsx)(ye.P9,{action:"THUNDER_III"}),(0,ke.jsx)(ye.P9,{action:"FIRE_IV"}),(0,ke.jsx)(ye.P9,{showIcon:!1,action:"THUNDER_III"}),(0,ke.jsx)(ye.P9,{status:"THUNDER_III"}),(0,ke.jsx)(ye.P9,{status:"THUNDERCLOUD"}),(0,ke.jsx)("a",{href:"#",onClick:function(e){e.preventDefault(),t.parser.scrollTo(a.handle)}}),(0,ke.jsx)(Ra.Z,{message:a.title})]}),severity:e>2*s?xe.bI.MAJOR:xe.bI.MEDIUM,why:(0,ke.jsx)(ge.Trans,{id:"blm.thunder.suggestions.excess-thunder.why",defaults:"Total DoT clipping exceeded the maximum clip time of {0} by {1}.",values:{0:this.parser.formatDuration(s),1:this.parser.formatDuration(e-s)}})}))}},{key:"createTargetStatusTable",value:function(t){var e,a=this,s=0;return(0,ke.jsxs)($e.Z,{collapsing:!0,unstackable:!0,children:[(0,ke.jsx)($e.Z.Header,{children:(0,ke.jsxs)($e.Z.Row,{children:[(0,ke.jsxs)($e.Z.HeaderCell,{children:[(0,ke.jsx)(ye.P9,{action:"THUNDER_III"})," ",(0,ke.jsx)(ge.Trans,{id:"blm.thunder.applied",defaults:"Applied"})]}),(0,ke.jsx)($e.Z.HeaderCell,{children:(0,ke.jsx)(ge.Trans,{id:"blm.thunder.clip",defaults:"Clip"})}),(0,ke.jsx)($e.Z.HeaderCell,{children:(0,ke.jsx)(ge.Trans,{id:"blm.thunder.total-clip",defaults:"Total Clip"})}),(0,ke.jsx)($e.Z.HeaderCell,{children:(0,ke.jsx)(ge.Trans,{id:"blm.thunder.source",defaults:"Source"})})]})}),(0,ke.jsx)($e.Z.Body,{children:ue()(e=t[this.data.statuses.THUNDER_III.id].applications).call(e,(function(t){var e=t.clip||0;s+=e;var i=a.data.getAction(t.source),n=(0,ke.jsx)(ye.vm,(0,We.Z)({showName:!1},i));t.proc&&(n=(0,ke.jsx)("div",{className:Aa.Z.procOverlay,children:(0,ke.jsx)(ye.vm,(0,We.Z)({showName:!1},i))}));var r=null!=t.clip?a.parser.formatDuration(t.clip):"-";return e>3e3&&e<=5e3&&(r=(0,ke.jsx)("span",{className:"text-warning",children:r})),e>5e3&&(r=(0,ke.jsx)("span",{className:"text-error",children:r})),(0,ke.jsxs)($e.Z.Row,{children:[(0,ke.jsx)($e.Z.Cell,{children:a.parser.formatEpochTimestamp(t.event.timestamp)}),(0,ke.jsx)($e.Z.Cell,{children:r}),(0,ke.jsx)($e.Z.Cell,{children:s?a.parser.formatDuration(s):"-"}),(0,ke.jsx)($e.Z.Cell,{style:{textAlign:"center"},children:n})]},t.event.timestamp)}))})]})}},{key:"output",value:function(){var t=this,e=Ea()(this.tracker).length,a=(0,ke.jsx)(da.Z,{children:(0,ke.jsx)(ge.Trans,{id:"blm.thunder.clip-disclaimer",defaults:"Due to the nature of <0/> procs, you will run into situations where you will use your <1/> proc before it runs out, while your <2/> is still running on your enemy. At most, this could theoretically lead to refreshing <3/> a maximum of ~3 seconds early every single refresh. Since this amount of clipping is still considered optimal, we quantify and call this the maximum clip time.",components:[(0,ke.jsx)(ye.P9,{action:"THUNDER_III"}),(0,ke.jsx)(ye.P9,{status:"THUNDERCLOUD"}),(0,ke.jsx)(ye.P9,{status:"THUNDER_III"}),(0,ke.jsx)(ye.P9,{showIcon:!1,status:"THUNDER_III"})]})});if(0===e)return null;if(e>1){var s,i=ue()(s=Ea()(this.tracker)).call(s,(function(e){var a=t.actors.get(e);return{key:e,title:{content:(0,ke.jsx)(ke.Fragment,{children:a.name})},content:{content:t.createTargetStatusTable(t.tracker[e])}}}));return(0,ke.jsxs)(ke.Fragment,{children:[a,(0,ke.jsx)(ja.Z,{exclusive:!1,panels:i,styled:!0,fluid:!0})]})}return(0,ke.jsxs)(ke.Fragment,{children:[a,this.createTargetStatusTable(Za()(this.tracker)[0])]})}}]),a}(Ye.qk),Ct.handle="thunder",Ct.title={id:"blm.thunder.title",defaults:"Thunder"},Ct.displayOrder=4,Et=Pt,wt=(0,oe.Z)(Et.prototype,"actors",[be.I,ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.actors}}),Zt=(0,oe.Z)(Et.prototype,"checklist",[be.I,vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.checklist}}),Rt=(0,oe.Z)(Et.prototype,"data",[be.I,yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.data}}),At=(0,oe.Z)(Et.prototype,"invulnerability",[be.I,It],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.invulnerability}}),St=(0,oe.Z)(Et.prototype,"procs",[be.I,bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.procs}}),jt=(0,oe.Z)(Et.prototype,"statuses",[be.I,Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.statuses}}),kt=(0,oe.Z)(Et.prototype,"suggestions",[be.I,xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.suggestions}}),Et),Ca=(Dt=Reflect.metadata("design:type",ca.e),Ft=Reflect.metadata("design:type",qe.V),_t=Reflect.metadata("design:type",xe.ZP),Lt=Ut=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return s=e.call.apply(e,Jt()(t=[this]).call(t,n)),(0,ne.Z)(s,"actors",Ot,(0,re.Z)(s)),(0,ne.Z)(s,"data",Ht,(0,re.Z)(s)),(0,ne.Z)(s,"suggestions",Mt,(0,re.Z)(s)),s.overwrittenTriples=0,s}return(0,Kt.Z)(a,[{key:"initialise",value:function(){this.addEventHook((0,ee.hX)().source(this.parser.actor.id).action(this.data.actions.TRIPLECAST.id),this.onTriplecast),this.addEventHook("complete",this.onComplete)}},{key:"onTriplecast",value:function(){this.actors.current.hasStatus(this.data.statuses.TRIPLECAST.id)&&this.overwrittenTriples++}},{key:"onComplete",value:function(){this.suggestions.add(new xe.eg({icon:this.data.actions.SHARPCAST.icon,content:(0,ke.jsx)(ge.Trans,{id:"blm.triplecast.suggestions.overwrote-triplecasts.content",defaults:"You lost at least one instant cast spell by using <0/> while the status was already active.",components:[(0,ke.jsx)(ye.P9,{action:"TRIPLECAST"})]}),tiers:{1:xe.bI.MINOR,2:xe.bI.MEDIUM,4:xe.bI.MAJOR},value:this.overwrittenTriples,why:(0,ke.jsx)(ge.Trans,{id:"blm.triplecast.suggestions.overwrote-triplecasts.why",defaults:"You overwrote <0/> .",components:[(0,ke.jsx)(ye.P9,{showIcon:!1,status:"TRIPLECAST"})]})}))}}]),a}(Ye.qk),Ut.handle="triplecast",Gt=Lt,Ot=(0,oe.Z)(Gt.prototype,"actors",[be.I,Dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.actors}}),Ht=(0,oe.Z)(Gt.prototype,"data",[be.I,Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.data}}),Mt=(0,oe.Z)(Gt.prototype,"suggestions",[be.I,_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.suggestions}}),Gt),Pa=a(45715),Da=["LUCID_DREAMING","ADDLE","SURECAST","TRANSPOSE"],Fa=["TRIPLECAST"],_a=(Nt=Reflect.metadata("design:type",Ne),Wt=function(t){(0,Yt.Z)(a,t);var e=(0,Xt.Z)(a);function a(){var t,s;(0,zt.Z)(this,a);for(var i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(s=e.call.apply(e,Jt()(t=[this]).call(t,n))).ogcdIds=ue()(Da).call(Da,(function(t){return s.data.actions[t].id})),s.openerIds=ue()(Fa).call(Fa,(function(t){return s.data.actions[t].id})),(0,ne.Z)(s,"gauge",Bt,(0,re.Z)(s)),s.iceSpellIds=ue()(je).call(je,(function(t){return s.data.actions[t].id})),s.fireSpellIds=ue()(Re).call(Re,(function(t){return s.data.actions[t].id})),s}return(0,Kt.Z)(a,[{key:"getMaxWeaves",value:function(t){var e=(0,Qt.Z)((0,te.Z)(a.prototype),"getMaxWeaves",this).call(this,t);return Math.max(this.getAllowedClippingWeaves(t),e)}},{key:"getAllowedClippingWeaves",value:function(t){var e,a,s,i,n,r=this;if(t.weaves.some((function(t){var e;return he()(e=r.ogcdIds).call(e,t.action)})))return 1;if(t.weaves.some((function(t){var e;return he()(e=r.openerIds).call(e,t.action)&&t.timestamp-r.parser.pull.timestamp<1e4})))return 1;var o=this.gauge.getGaugeState(null===(e=t.leadingGcdEvent)||void 0===e?void 0:e.timestamp),l=null!==(a=null===(s=t.leadingGcdEvent)||void 0===s?void 0:s.action)&&void 0!==a?a:0;return he()(i=this.iceSpellIds).call(i,l)&&3===o.astralFire||he()(n=this.fireSpellIds).call(n,l)&&3===o.umbralIce?1:0}}]),a}(Pa.x),Bt=(0,oe.Z)(Wt.prototype,"gauge",[be.I,Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.gauge}}),Wt),Ga=[$t,_a,se,ie,Ne,Vt.e,Qe,sa,na,oa,ya,ba,ka,Ca]}}]);
//# sourceMappingURL=jobs-blm.bb9a1dee.js.map